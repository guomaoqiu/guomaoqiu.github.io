<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Redisé›†ç¾¤è¯¦ç»†æ­å»ºæŒ‡å— | OpsThoughts</title><meta name="author" content="NoardGuo-Ops"><meta name="copyright" content="NoardGuo-Ops"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Redis é›†ç¾¤ç®€ä»‹Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œç”±äºå‡ºä¼—çš„æ€§èƒ½ï¼Œå¤§éƒ¨åˆ†äº’è”ç½‘ä¼ä¸šéƒ½ç”¨æ¥åšæœåŠ¡å™¨ç«¯ç¼“å­˜ã€‚Redis åœ¨3.0ç‰ˆæœ¬å‰åªæ”¯æŒå•å®ä¾‹æ¨¡å¼ï¼Œè™½ç„¶æ”¯æŒä¸»ä»æ¨¡å¼ã€å“¨å…µæ¨¡å¼éƒ¨ç½²æ¥è§£å†³å•ç‚¹æ•…éšœï¼Œä½†æ˜¯ç°åœ¨äº’è”ç½‘ä¼ä¸šåŠ¨è¾„å¤§å‡ ç™¾Gçš„æ•°æ®ï¼Œå¯å®Œå…¨æ˜¯æ²¡æ³•æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œæ‰€ä»¥ï¼ŒRedis åœ¨ 3.0 ç‰ˆæœ¬ä»¥åå°±æ¨å‡ºäº†é›†ç¾¤æ¨¡å¼ã€‚ Redis ä»3.0.0æ­£å¼ç‰ˆå¼€å§‹å®˜æ–¹æ”¯æŒé›†ç¾¤, Red">
<meta property="og:type" content="article">
<meta property="og:title" content="Redisé›†ç¾¤è¯¦ç»†æ­å»ºæŒ‡å—">
<meta property="og:url" content="https://blog.sctux.cc/2017/06/04/redis-ji-qun-xiang-xi-da-jian-zhi-nan/index.html">
<meta property="og:site_name" content="OpsThoughts">
<meta property="og:description" content="Redis é›†ç¾¤ç®€ä»‹Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œç”±äºå‡ºä¼—çš„æ€§èƒ½ï¼Œå¤§éƒ¨åˆ†äº’è”ç½‘ä¼ä¸šéƒ½ç”¨æ¥åšæœåŠ¡å™¨ç«¯ç¼“å­˜ã€‚Redis åœ¨3.0ç‰ˆæœ¬å‰åªæ”¯æŒå•å®ä¾‹æ¨¡å¼ï¼Œè™½ç„¶æ”¯æŒä¸»ä»æ¨¡å¼ã€å“¨å…µæ¨¡å¼éƒ¨ç½²æ¥è§£å†³å•ç‚¹æ•…éšœï¼Œä½†æ˜¯ç°åœ¨äº’è”ç½‘ä¼ä¸šåŠ¨è¾„å¤§å‡ ç™¾Gçš„æ•°æ®ï¼Œå¯å®Œå…¨æ˜¯æ²¡æ³•æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œæ‰€ä»¥ï¼ŒRedis åœ¨ 3.0 ç‰ˆæœ¬ä»¥åå°±æ¨å‡ºäº†é›†ç¾¤æ¨¡å¼ã€‚ Redis ä»3.0.0æ­£å¼ç‰ˆå¼€å§‹å®˜æ–¹æ”¯æŒé›†ç¾¤, Red">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800&h=400">
<meta property="article:published_time" content="2017-06-04T06:17:26.000Z">
<meta property="article:modified_time" content="2025-09-01T01:59:08.955Z">
<meta property="article:author" content="NoardGuo-Ops">
<meta property="article:tag" content="redis-cluster">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800&h=400"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Redisé›†ç¾¤è¯¦ç»†æ­å»ºæŒ‡å—",
  "url": "https://blog.sctux.cc/2017/06/04/redis-ji-qun-xiang-xi-da-jian-zhi-nan/",
  "image": "https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800&h=400",
  "datePublished": "2017-06-04T06:17:26.000Z",
  "dateModified": "2025-09-01T01:59:08.955Z",
  "author": [
    {
      "@type": "Person",
      "name": "NoardGuo-Ops",
      "url": "https://blog.sctux.cc"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.sctux.cc/2017/06/04/redis-ji-qun-xiang-xi-da-jian-zhi-nan/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redisé›†ç¾¤è¯¦ç»†æ­å»ºæŒ‡å—',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="OpsThoughts" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">93</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">30</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/works/"><i class="fa-fw fas fa-folder-open"></i><span> ä½œå“</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºæˆ‘</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800&amp;h=400);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">OpsThoughts</span></a><a class="nav-page-title" href="/"><span class="site-name">Redisé›†ç¾¤è¯¦ç»†æ­å»ºæŒ‡å—</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/works/"><i class="fa-fw fas fa-folder-open"></i><span> ä½œå“</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äºæˆ‘</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Redisé›†ç¾¤è¯¦ç»†æ­å»ºæŒ‡å—</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2017-06-04T06:17:26.000Z" title="å‘è¡¨äº 2017-06-04 14:17:26">2017-06-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-09-01T01:59:08.955Z" title="æ›´æ–°äº 2025-09-01 09:59:08">2025-09-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="Redis-é›†ç¾¤ç®€ä»‹"><a href="#Redis-é›†ç¾¤ç®€ä»‹" class="headerlink" title="Redis é›†ç¾¤ç®€ä»‹"></a>Redis é›†ç¾¤ç®€ä»‹</h2><p>Redis æ˜¯ä¸€ä¸ªå¼€æºçš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œç”±äºå‡ºä¼—çš„æ€§èƒ½ï¼Œå¤§éƒ¨åˆ†äº’è”ç½‘ä¼ä¸šéƒ½ç”¨æ¥åšæœåŠ¡å™¨ç«¯ç¼“å­˜ã€‚Redis åœ¨3.0ç‰ˆæœ¬å‰åªæ”¯æŒå•å®ä¾‹æ¨¡å¼ï¼Œè™½ç„¶æ”¯æŒä¸»ä»æ¨¡å¼ã€å“¨å…µæ¨¡å¼éƒ¨ç½²æ¥è§£å†³å•ç‚¹æ•…éšœï¼Œä½†æ˜¯ç°åœ¨äº’è”ç½‘ä¼ä¸šåŠ¨è¾„å¤§å‡ ç™¾Gçš„æ•°æ®ï¼Œå¯å®Œå…¨æ˜¯æ²¡æ³•æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œæ‰€ä»¥ï¼ŒRedis åœ¨ 3.0 ç‰ˆæœ¬ä»¥åå°±æ¨å‡ºäº†é›†ç¾¤æ¨¡å¼ã€‚</p>
<p>Redis ä»3.0.0æ­£å¼ç‰ˆå¼€å§‹å®˜æ–¹æ”¯æŒé›†ç¾¤, Redis é›†ç¾¤é‡‡ç”¨äº†P2Pçš„æ¨¡å¼ï¼Œå®Œå…¨å»ä¸­å¿ƒåŒ–ã€‚Redis æŠŠæ‰€æœ‰çš„ Key åˆ†æˆäº† 16384 ä¸ª slotï¼Œæ¯ä¸ª Redis å®ä¾‹è´Ÿè´£å…¶ä¸­ä¸€éƒ¨åˆ† slot ã€‚é›†ç¾¤ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆèŠ‚ç‚¹ã€ç«¯å£ã€slotç­‰ï¼‰ï¼Œéƒ½é€šè¿‡èŠ‚ç‚¹ä¹‹é—´å®šæœŸçš„æ•°æ®äº¤æ¢è€Œæ›´æ–°ã€‚</p>
<p>Redis å®¢æˆ·ç«¯å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ª Redis å®ä¾‹å‘å‡ºè¯·æ±‚ï¼Œå¦‚æœæ‰€éœ€æ•°æ®ä¸åœ¨è¯¥å®ä¾‹ä¸­ï¼Œé€šè¿‡é‡å®šå‘å‘½ä»¤å¼•å¯¼å®¢æˆ·ç«¯è®¿é—®æ‰€éœ€çš„å®ä¾‹ã€‚</p>
<h2 id="éšéšä¾¿ä¾¿æ­å»ºä¸€ä¸ªé›†ç¾¤"><a href="#éšéšä¾¿ä¾¿æ­å»ºä¸€ä¸ªé›†ç¾¤" class="headerlink" title="éšéšä¾¿ä¾¿æ­å»ºä¸€ä¸ªé›†ç¾¤"></a>éšéšä¾¿ä¾¿æ­å»ºä¸€ä¸ªé›†ç¾¤</h2><p>å®‰è£…éƒ¨ç½²ä»»ä½•ä¸€ä¸ªåº”ç”¨å…¶å®éƒ½å¾ˆç®€å•ï¼Œåªè¦å®‰è£…æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥å°±è¡Œäº†ã€‚ä¸‹é¢è¯´ä¸€ä¸‹ Redis é›†ç¾¤æ­å»ºè§„åˆ’ï¼Œç”±äºé›†ç¾¤è‡³å°‘éœ€è¦6ä¸ªèŠ‚ç‚¹ï¼ˆ3ä¸»3ä»æ¨¡å¼ï¼‰ï¼Œæ‰€ä»¥ï¼Œæ²¡æœ‰è¿™ä¹ˆå¤šæœºå™¨ç»™æˆ‘ç©ï¼Œç°åœ¨è®¡åˆ’æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªé›†ç¾¤ï¼Œå½“ç„¶ï¼Œè¿™å’Œç”Ÿäº§ç¯å¢ƒçš„é›†ç¾¤æ­å»ºæ²¡æœ¬è´¨åŒºåˆ«ã€‚</p>
<h4 id="1-è·å–è½¯ä»¶åŒ…"><a href="#1-è·å–è½¯ä»¶åŒ…" class="headerlink" title="1.è·å–è½¯ä»¶åŒ…"></a>1.è·å–è½¯ä»¶åŒ…</h4><pre><code>cd /tmp/ &amp;&amp; wget http://download.redis.io/releases/redis-4.0.11.tar.gz
mkdir /usr/local/redis &amp;&amp; tar -xr /tmp/redis-4.0.11.tar.gz -C /usr/local/redis
cd /usr/local/redis
./configure
make -j 4
make install
</code></pre>
<h4 id="2-è§„åˆ’åˆ›å»ºæ–‡ä»¶ç›®å½•"><a href="#2-è§„åˆ’åˆ›å»ºæ–‡ä»¶ç›®å½•" class="headerlink" title="2.è§„åˆ’åˆ›å»ºæ–‡ä»¶ç›®å½•"></a>2.è§„åˆ’åˆ›å»ºæ–‡ä»¶ç›®å½•</h4><p>æˆ‘ä»¬è®¡åˆ’é›†ç¾¤ä¸­ Redis èŠ‚ç‚¹çš„ç«¯å£å·ä¸º 9001-9006 ï¼Œç«¯å£å·å³é›†ç¾¤ä¸‹å„å®ä¾‹æ–‡ä»¶å¤¹ã€‚æ•°æ®å­˜æ”¾åœ¨ ç«¯å£å·/data æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<pre><code>mkdir /usr/local/redis-cluster/
cd /usr/local/redis-cluster/

for i in {1..6};do
    mkdir 900${i}/data
done
</code></pre>
<h4 id="3-å¤åˆ¶æ‰§è¡Œè„šæœ¬"><a href="#3-å¤åˆ¶æ‰§è¡Œè„šæœ¬" class="headerlink" title="3. å¤åˆ¶æ‰§è¡Œè„šæœ¬"></a>3. å¤åˆ¶æ‰§è¡Œè„šæœ¬</h4><p>åœ¨ /usr/local/redis-cluster ä¸‹åˆ›å»º bin æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾é›†ç¾¤è¿è¡Œè„šæœ¬ï¼Œå¹¶æŠŠå®‰è£…å¥½çš„ Redis çš„ src è·¯å¾„ä¸‹çš„è¿è¡Œè„šæœ¬æ‹·è´è¿‡æ¥ã€‚çœ‹å‘½ä»¤ï¼š</p>
<pre><code>mkdir /usr/local/redis-cluster/bin
cd /usr/local/redis/src # ä¸‹è½½åè§£å‹ç¼–è¯‘åçš„srcç›®å½•
cp mkreleasehdr.sh redis-benchmark redis-check-aof redis-check-dump redis-cli redis-server redis-trib.rb /usr/local/redis-cluster/bin
</code></pre>
<h4 id="4-å¤åˆ¶ä¸€ä¸ªæ–°-Redis-å®ä¾‹"><a href="#4-å¤åˆ¶ä¸€ä¸ªæ–°-Redis-å®ä¾‹" class="headerlink" title="4.å¤åˆ¶ä¸€ä¸ªæ–° Redis å®ä¾‹"></a>4.å¤åˆ¶ä¸€ä¸ªæ–° Redis å®ä¾‹</h4><p>æˆ‘ä»¬ç°åœ¨ä»å·²å®‰è£…å¥½çš„ Redis ä¸­å¤åˆ¶ä¸€ä¸ªæ–°çš„å®ä¾‹åˆ° 9001 æ–‡ä»¶å¤¹ï¼Œå¹¶ä¿®æ”¹ redis.conf é…ç½®ã€‚</p>
<pre><code>cp /usr/local/redis/* /usr/local/redis-cluster/9001


port 9001ï¼ˆæ¯ä¸ªèŠ‚ç‚¹çš„ç«¯å£å·ï¼‰
daemonize yes
bind 192.168.56.127ï¼ˆç»‘å®šå½“å‰æœºå™¨ IPï¼‰
dir /usr/local/redis-cluster/9001/data/ï¼ˆæ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼‰
pidfile /var/run/redis_9001.pidï¼ˆpid 9001å’Œportè¦å¯¹åº”ï¼‰
cluster-enabled yesï¼ˆå¯åŠ¨é›†ç¾¤æ¨¡å¼ï¼‰
cluster-config-file nodes9001.confï¼ˆ9001å’Œportè¦å¯¹åº”ï¼‰
cluster-node-timeout 15000
appendonly yes
</code></pre>
<h4 id="5-å†å¤åˆ¶å‡ºäº”ä¸ªæ–°-Redis-å®ä¾‹"><a href="#5-å†å¤åˆ¶å‡ºäº”ä¸ªæ–°-Redis-å®ä¾‹" class="headerlink" title="5.å†å¤åˆ¶å‡ºäº”ä¸ªæ–° Redis å®ä¾‹"></a>5.å†å¤åˆ¶å‡ºäº”ä¸ªæ–° Redis å®ä¾‹</h4><p>æˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œå…¶å®æ¥ä¸‹æ¥å°±æ˜¯æœºæ¢°åŒ–çš„å†å®Œæˆå¦å¤–äº”ä¸ªèŠ‚ç‚¹ï¼Œå…¶å®å¯ä»¥è¿™ä¹ˆåšï¼šæŠŠ 9001 å®ä¾‹ å¤åˆ¶åˆ°å¦å¤–äº”ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå”¯ä¸€è¦ä¿®æ”¹çš„å°±æ˜¯ redis.conf ä¸­çš„æ‰€æœ‰å’Œç«¯å£çš„ç›¸å…³çš„ä¿¡æ¯å³å¯ï¼Œå…¶å®å°±é‚£ä¹ˆå››ä¸ªä½ç½®ã€‚å¼€å§‹æ“ä½œï¼Œçœ‹å‘½ä»¤ï¼š</p>
<pre><code>\cp -rf /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9002
\cp -rf /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9003
\cp -rf /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9004
\cp -rf /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9005
\cp -rf /usr/local/redis-cluster/9001/* /usr/local/redis-cluster/9006
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬æŠŠé…ç½®å¤åˆ¶è¿‡å»ä¹‹åéœ€è¦ä¿®æ”¹å¯¹åº”æ–‡ä»¶å¤¹ä¸­çš„redis.conf ç”¨sedæˆ–è€…vimå…¨å±€æ›¿æ¢å³å¯ï¼Œä¸»è¦æ˜¯ç«¯å£</p>
<p>ä¸‹é¢ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å¯åŠ¨å®ƒä»¬</p>
<pre><code>for i in {1..6};do
    /usr/local/bin/redis-server /usr/local/redis-cluster/900${i}/redis.conf 
done


[root@localhost redis-cluster]# ps aux | grep redis | grep -v grep
root       3995  0.5  0.6 151404 11864 ?        Ssl  10:51   0:10 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9001 [cluster]
root       4000  0.4  0.6 151404 11856 ?        Ssl  10:51   0:09 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9002 [cluster]
root       4005  0.4  0.6 151404 11856 ?        Ssl  10:51   0:09 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9003 [cluster]
root       4010  0.1  0.6 151404 11872 ?        Ssl  10:51   0:02 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9004 [cluster]
root       4015  0.0  0.6 151404 11876 ?        Ssl  10:51   0:01 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9005 [cluster]
root       4020  0.0  0.6 151404 11872 ?        Ssl  10:51   0:01 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9006 [cluster]
root       4509  0.8  0.6 149356 11880 ?        Ssl  10:55   0:14 /usr/local/redis-cluster/bin/redis-server 
[root@localhost redis-cluster]#
</code></pre>
<p>ä»¥ä¸Š å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„6ä¸ªå®ä¾‹å·²ç»å¯åŠ¨äº†<br>æµ‹è¯•ä¸€ä¸‹ï¼Ÿ</p>
<p>éšä¾¿æ‰¾ä¸ªèŠ‚ç‚¹æµ‹è¯•ä¸€ä¸‹:</p>
<pre><code>/usr/local/redis-cluster/bin/redis-cli -h 192.168.56.127 -p 9001

192.168.56.127:9001&gt; set name guomaoqiu
(error) CLUSTERDOWN Hash slot not served
192.168.56.127:9001&gt;
</code></pre>
<p>è¿æ¥æˆåŠŸäº†ï¼Œä½†å¥½åƒæŠ¥é”™äº†</p>
<p>è¿™æ˜¯å› ä¸ºè™½ç„¶æˆ‘ä»¬é…ç½®å¹¶å¯åŠ¨äº† Redis é›†ç¾¤æœåŠ¡ï¼Œä½†æ˜¯ä»–ä»¬æš‚æ—¶è¿˜å¹¶ä¸åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œäº’ç›¸ç›´æ¥å‘ç°ä¸äº†ï¼Œè€Œä¸”è¿˜æ²¡æœ‰å¯å­˜å‚¨çš„ä½ç½®ï¼Œå°±æ˜¯æ‰€è°“çš„slotï¼ˆæ§½ï¼‰ã€‚</p>
<h4 id="6-å®‰è£…é›†ç¾¤æ‰€éœ€è½¯ä»¶"><a href="#6-å®‰è£…é›†ç¾¤æ‰€éœ€è½¯ä»¶" class="headerlink" title="6.å®‰è£…é›†ç¾¤æ‰€éœ€è½¯ä»¶"></a>6.å®‰è£…é›†ç¾¤æ‰€éœ€è½¯ä»¶</h4><p>ç”±äº Redis é›†ç¾¤éœ€è¦ä½¿ç”¨ ruby å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£… ruby å’Œç›¸å…³æ¥å£ã€‚</p>
<pre><code>å®‰è£…rediséœ€è¦rubyç‰ˆæœ¬æœ€ä½æ˜¯2.2.2ï¼Œè€Œcentos yumåº“ä¸­rubyç‰ˆæœ¬æ”¯æŒåˆ°2.0.0ã€‚æ‰€ä»¥ï¼Œæ— æ³•æ»¡è¶³éœ€æ±‚ã€‚
è§£å†³æ–¹æ¡ˆï¼š

1.å®‰è£…curl
sudo yum install curl
2.å®‰è£…RVM
curl -L get.rvm.io | bash -s stable
source /usr/local/rvm/scripts/rvm
3.æŸ¥çœ‹rvmåº“ä¸­å·²çŸ¥çš„rubyç‰ˆæœ¬
rvm list known
4.å®‰è£…ä¸€ä¸ªrubyç‰ˆæœ¬
rvm install 2.3.3
5.è®¾ç½®é»˜è®¤ç‰ˆæœ¬
rvm use 2.3.3
6.å¸è½½ä¸€ä¸ªå·²çŸ¥ç‰ˆæœ¬
rvm remove 2.0.0
7.æŸ¥çœ‹rubyç‰ˆæœ¬
ruby â€“version
8.å†å®‰è£…rediså°±å¯ä»¥äº†
gem install redis
</code></pre>
<h4 id="7-åˆ©ç”¨å®˜æ–¹æä¾›çš„å‘½ä»¤åˆ›å»ºé›†ç¾¤"><a href="#7-åˆ©ç”¨å®˜æ–¹æä¾›çš„å‘½ä»¤åˆ›å»ºé›†ç¾¤" class="headerlink" title="7. åˆ©ç”¨å®˜æ–¹æä¾›çš„å‘½ä»¤åˆ›å»ºé›†ç¾¤"></a>7. åˆ©ç”¨å®˜æ–¹æä¾›çš„å‘½ä»¤åˆ›å»ºé›†ç¾¤</h4><pre><code>/usr/local/redis-cluster/bin/redis-trib.rb create --replicas 1 192.168.56.127:9001 192.168.56.127:9002 192.168.56.127:9003 192.168.56.127:9004 192.168.56.127:9005 192.168.56.127:9006
</code></pre>
<p>ç®€å•è§£é‡Šä¸€ä¸‹è¿™ä¸ªå‘½ä»¤ï¼šè°ƒç”¨ ruby å‘½ä»¤æ¥è¿›è¡Œåˆ›å»ºé›†ç¾¤ï¼Œâ€“replicas 1 è¡¨ç¤ºä¸»ä»å¤åˆ¶æ¯”ä¾‹ä¸º 1:1ï¼Œå³ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªä»èŠ‚ç‚¹ï¼›ç„¶åï¼Œé»˜è®¤ç»™æˆ‘ä»¬åˆ†é…å¥½äº†æ¯ä¸ªä¸»èŠ‚ç‚¹å’Œå¯¹åº”ä»èŠ‚ç‚¹æœåŠ¡ï¼Œä»¥åŠ solt çš„å¤§å°ï¼Œå› ä¸ºåœ¨ Redis é›†ç¾¤ä¸­æœ‰ä¸”ä»…æœ‰ 16383 ä¸ª solt ï¼Œé»˜è®¤æƒ…å†µä¼šç»™æˆ‘ä»¬å¹³å‡åˆ†é…ï¼Œå½“ç„¶ä½ å¯ä»¥æŒ‡å®šï¼Œåç»­çš„å¢å‡èŠ‚ç‚¹ä¹Ÿå¯ä»¥é‡æ–°åˆ†é…ã€‚</p>
<pre><code>[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb create --replicas 1 192.168.56.127:9001 192.168.56.127:9002 192.168.56.127:9003 192.168.56.127:9004 192.168.56.127:9005 192.168.56.127:9006
&gt;&gt;&gt; Creating cluster
&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...
Using 3 masters:
# ä¸‰ä¸ªä¸»èŠ‚ç‚¹
192.168.56.127:9001
192.168.56.127:9002
192.168.56.127:9003
# ä¸‰ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸‰ä¸ªä»èŠ‚ç‚¹
Adding replica 192.168.56.127:9005 to 192.168.56.127:9001
Adding replica 192.168.56.127:9006 to 192.168.56.127:9002
Adding replica 192.168.56.127:9004 to 192.168.56.127:9003
&gt;&gt;&gt; Trying to optimize slaves allocation for anti-affinity
[WARNING] Some slaves are in the same host as their master
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:0-5460 (5461 slots) master
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:5461-10922 (5462 slots) master
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots:10923-16383 (5461 slots) master
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   replicates e070e76789352d2492cfc9800850e943e0c4b72d
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   replicates 0fcbaa301451baf87284546513003568e47b5daa
Can I set the above configuration? (type 'yes' to accept): yes
&gt;&gt;&gt; Nodes configuration updated
&gt;&gt;&gt; Assign a different config epoch to each node
&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
Waiting for the cluster to join...
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:0-5460 (5461 slots) master
   1 additional replica(s)
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:5461-10922 (5462 slots) master
   1 additional replica(s)
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots:10923-16383 (5461 slots) master
   1 additional replica(s)
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates e070e76789352d2492cfc9800850e943e0c4b72d
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
</code></pre>
<p>ä»¥ä¸Šæ‰§è¡Œç»“æœä»£è¡¨é›†ç¾¤æ­å»ºæˆåŠŸå•¦ï¼ï¼ï¼</p>
<p>éªŒè¯ï¼š</p>
<pre><code>/usr/local/redis-cluster/bin/redis-cli -c -h 192.168.56.127 -p 9001
192.168.56.127:9001&gt; cluster info
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:6
cluster_my_epoch:1
cluster_stats_messages_ping_sent:167
cluster_stats_messages_pong_sent:172
cluster_stats_messages_sent:339
cluster_stats_messages_ping_received:167
cluster_stats_messages_pong_received:167
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:339
192.168.56.127:9001&gt; cluster nodes
474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002@19002 master - 0 1536205294229 2 connected 5461-10922
e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003@19003 master - 0 1536205293000 3 connected 10923-16383
bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006@19006 slave 0fcbaa301451baf87284546513003568e47b5daa 0 1536205295234 6 connected
0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001@19001 myself,master - 0 1536205294000 1 connected 0-5460
950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004@19004 slave 474fd53f7199ad70cce7f18bd68f5445b559509a 0 1536205293217 4 connected
17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005@19005 slave e070e76789352d2492cfc9800850e943e0c4b72d 0 1536205292212 5 connected
192.168.56.127:9001&gt; set name guomaoqiu
-&gt; Redirected to slot [5798] located at 192.168.56.127:9002
OK
192.168.56.127:9002&gt; get name
"guomaoqiu"
192.168.56.127:9002&gt;
</code></pre>
<p>é€šè¿‡å‘½ä»¤ï¼Œå¯ä»¥è¯¦ç»†çš„çœ‹å‡ºé›†ç¾¤ä¿¡æ¯å’Œå„ä¸ªèŠ‚ç‚¹çŠ¶æ€ï¼Œä¸»ä»ä¿¡æ¯ä»¥åŠè¿æ¥æ•°ã€æ§½ä¿¡æ¯ç­‰ã€‚è¿™ä¹ˆçœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»çœŸçš„æŠŠ Redis é›†ç¾¤æ­å»ºéƒ¨ç½²æˆåŠŸå•¦ï¼</p>
<h2 id="å¦‚ä½•æ–°å¢èŠ‚ç‚¹ï¼Ÿ"><a href="#å¦‚ä½•æ–°å¢èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ–°å¢èŠ‚ç‚¹ï¼Ÿ"></a>å¦‚ä½•æ–°å¢èŠ‚ç‚¹ï¼Ÿ</h2><p>æ–°å¢èŠ‚ç‚¹æ— éå°±æ˜¯å¤åˆ¶é…ç½®ï¼Œä¿®æ”¹é…ç½®ï¼Œç„¶åå¯åŠ¨ï¼›æˆ‘è¿™é‡Œè¿˜æ˜¯åˆ›å»ºäº†ä¸€å¯¹ä¸€ä¸»ä¸€ä»çš„é…ç½®ï¼Œç«¯å£åˆ†åˆ«å¯¹åº”çš„æ˜¯9007ã€9008</p>
<h4 id="1-å¯åŠ¨ä¸¤ä¸ªå®ä¾‹-å‡è®¾æˆ‘è¿™é‡Œå·²ç»å¤åˆ¶é…ç½®ï¼Œä¿®æ”¹å®Œé…ç½®äº†"><a href="#1-å¯åŠ¨ä¸¤ä¸ªå®ä¾‹-å‡è®¾æˆ‘è¿™é‡Œå·²ç»å¤åˆ¶é…ç½®ï¼Œä¿®æ”¹å®Œé…ç½®äº†" class="headerlink" title="1.å¯åŠ¨ä¸¤ä¸ªå®ä¾‹(å‡è®¾æˆ‘è¿™é‡Œå·²ç»å¤åˆ¶é…ç½®ï¼Œä¿®æ”¹å®Œé…ç½®äº†)"></a>1.å¯åŠ¨ä¸¤ä¸ªå®ä¾‹(å‡è®¾æˆ‘è¿™é‡Œå·²ç»å¤åˆ¶é…ç½®ï¼Œä¿®æ”¹å®Œé…ç½®äº†)</h4><pre><code>for i in {7..8};do
    /usr/local/redis-cluster/bin/redis-server /usr/local/redis-cluster/900${i}/redis.conf 
done

6002:C 06 Sep 11:50:53.048 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
6002:C 06 Sep 11:50:53.048 # Redis version=4.0.11, bits=64, commit=00000000, modified=0, pid=6002, just started
6002:C 06 Sep 11:50:53.048 # Configuration loaded
6004:C 06 Sep 11:50:53.060 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
6004:C 06 Sep 11:50:53.060 # Redis version=4.0.11, bits=64, commit=00000000, modified=0, pid=6004, just started
6004:C 06 Sep 11:50:53.060 # Configuration loaded

ps aux | grep redis | grep -v grep
redis      1180  0.0  0.3 142900  5828 ?        Ssl  11:28   0:01 /usr/bin/redis-server 0.0.0.0:6379
root       4257  0.0  0.6 149356 11880 ?        Ssl  11:32   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9001 [cluster]
root       4262  0.0  0.6 149356 11880 ?        Ssl  11:32   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9002 [cluster]
root       4267  0.0  0.6 149356 11876 ?        Ssl  11:32   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9003 [cluster]
root       4272  0.0  0.6 149356 11908 ?        Ssl  11:32   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9004 [cluster]
root       4277  0.0  0.6 149356 11920 ?        Ssl  11:32   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9005 [cluster]
root       4282  0.0  0.6 149356 11912 ?        Ssl  11:32   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9006 [cluster]
root       6003  0.1  0.5 147308  9616 ?        Ssl  11:50   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9007 [cluster]
root       6008  0.0  0.5 147308  9616 ?        Ssl  11:50   0:00 /usr/local/redis-cluster/bin/redis-server 192.168.56.127:9008 [cluster]
</code></pre>
<p>ä»¥ä¸Š å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯åŠ¨äº†åé¢ä¸¤ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸­æ ‡æ³¨äº†æ˜¯ä»¥é›†ç¾¤æ–¹å¼å¯åŠ¨, ä½†æ˜¯æ­¤æ—¶è¿˜å¹¶æ²¡æœ‰å°†å®ä¾‹åŠ å…¥åˆ°é›†ç¾¤å½“ä¸­ã€‚</p>
<h4 id="2-æ·»åŠ å®ä¾‹åˆ°é›†ç¾¤"><a href="#2-æ·»åŠ å®ä¾‹åˆ°é›†ç¾¤" class="headerlink" title="2.æ·»åŠ å®ä¾‹åˆ°é›†ç¾¤"></a>2.æ·»åŠ å®ä¾‹åˆ°é›†ç¾¤</h4><pre><code>[root@locahost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb add-node 192.168.56.127:9007 192.168.56.127:9001
&gt;&gt;&gt; Adding node 192.168.56.127:9007 to cluster 192.168.56.127:9001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:0-5460 (5461 slots) master
   1 additional replica(s)
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:5461-10922 (5462 slots) master
   1 additional replica(s)
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots:10923-16383 (5461 slots) master
   1 additional replica(s)
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates e070e76789352d2492cfc9800850e943e0c4b72d
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.56.127:9007 to make it join the cluster.
[OK] New node added correctly.
[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-cli -c -h 192.168.56.127 -p 9001 cluster nodes
474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002@19002 master - 0 1536215194000 2 connected 5461-10922
e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003@19003 master - 0 1536215194000 3 connected 10923-16383
bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006@19006 slave 0fcbaa301451baf87284546513003568e47b5daa 0 1536215193000 6 connected
0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001@19001 myself,master - 0 1536215192000 1 connected 0-5460
950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004@19004 slave 474fd53f7199ad70cce7f18bd68f5445b559509a 0 1536215195858 4 connected
1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9007@19007 master - 0 1536215195000 0 connected
17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005@19005 slave e070e76789352d2492cfc9800850e943e0c4b72d 0 1536215194855 5 connected
</code></pre>
<p>ä»¥ä¸Šå¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡ add-node å‚æ•°æ·»åŠ äº† 9007è¿™ä¸ªå®ä¾‹ï¼›å‘½ä»¤æœ€åä¸€ä¸ªå‚æ•°æ˜¯å·²ç»æˆä¸ºé›†ç¾¤çš„é›†ç¾¤æˆå‘˜host:port<br>è€Œä¸”å®ä¾‹9007è·å¾—äº†ä¸€ä¸ªé›†ç¾¤ID:<code>1714784542b3afc9e2a8b2c93fff49d095e7d72b</code></p>
<h4 id="5-å¢åŠ å®ä¾‹çš„ä»èŠ‚ç‚¹åˆ°é›†ç¾¤"><a href="#5-å¢åŠ å®ä¾‹çš„ä»èŠ‚ç‚¹åˆ°é›†ç¾¤" class="headerlink" title="5. å¢åŠ å®ä¾‹çš„ä»èŠ‚ç‚¹åˆ°é›†ç¾¤"></a>5. å¢åŠ å®ä¾‹çš„ä»èŠ‚ç‚¹åˆ°é›†ç¾¤</h4><p>ä»¥ä¸Šæˆ‘ä»¬å°†å®ä¾‹9007ä½œä¸ºmasterå¢åŠ åˆ°äº†é›†ç¾¤ä¸­ï¼Œä½†æ˜¯æŒ‰ç…§å‰é¢çš„è§„åˆ’ï¼Œæ¯ä¸ªmasterå¯¹åº”ä¸€ä¸ªslaveæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å®ä¾‹9008åŠ å…¥é›†ç¾¤å¹¶å°†å…¶ç§°ä¸º9007çš„slave,å‘½ä»¤å¦‚ä¸‹</p>
<pre><code>[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb add-node --slave --master-id 1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9008 192.168.56.127:9001
&gt;&gt;&gt; Adding node 192.168.56.127:9008 to cluster 192.168.56.127:9001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:0-5460 (5461 slots) master
   1 additional replica(s)
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:5461-10922 (5462 slots) master
   1 additional replica(s)
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots:10923-16383 (5461 slots) master
   1 additional replica(s)
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
M: 1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9007
   slots: (0 slots) master
   0 additional replica(s)
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates e070e76789352d2492cfc9800850e943e0c4b72d
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.56.127:9008 to make it join the cluster.
Waiting for the cluster to join.
&gt;&gt;&gt; Configure node as replica of 192.168.56.127:9007.
[OK] New node added correctly.

[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb check 192.168.56.127:9001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:0-5460 (5461 slots) master
   1 additional replica(s)
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:5461-10922 (5462 slots) master
   1 additional replica(s)
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots:10923-16383 (5461 slots) master
   1 additional replica(s)
S: 5ed978b695e6a222e67d13c68e55f6c4e74b7ba6 192.168.56.127:9008
   slots: (0 slots) slave
   replicates 1714784542b3afc9e2a8b2c93fff49d095e7d72b
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
M: 1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9007
   slots: (0 slots) master
   1 additional replica(s)
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates e070e76789352d2492cfc9800850e943e0c4b72d
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
</code></pre>
<p>ä»¥ä¸Šæˆ‘ä»¬å°†ä¸¤ä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°äº†é›†ç¾¤ä¸­ï¼Œä½†æ˜¯ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°æˆ‘ä»¬çš„å®ä¾‹9007æ‰€æ‹¥æœ‰çš„slotæ•°é‡ä¸º0ï¼Œé‚£æ­¤æ—¶å°±éœ€è¦å°†é‡æ–°è°ƒæ•´å“ˆå¸Œæ§½å•¦~<br>å†æ¬¡ä¹‹å‰æˆ‘ä»¬ä¸‰ä¸ªmaster å¹³å‡å°†16384 åˆ†æˆäº†ä¸‰ç­‰åˆ†ï¼Œé‚£æˆ‘ä»¬æ–°å¢åŠ äº†ä¸€ä¸ªmaster ï¼Œä¸ºäº†å¹³è¡¡æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºè¿™ä¸ªæ–°çš„masteréœ€è¦å¤šå°‘å“ˆå¸Œæ§½ï¼Œå³ 16384/4 = 4096 æˆ‘ä»¬éœ€è¦ç§»åŠ¨4096ä¸ªæ§½ç‚¹åˆ°9007ä¸Šã€‚</p>
<pre><code>[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb reshard 192.168.56.127:9001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:0-5460 (5461 slots) master
   1 additional replica(s)
S: 5ed978b695e6a222e67d13c68e55f6c4e74b7ba6 192.168.56.127:9008
   slots: (0 slots) slave
   replicates 1714784542b3afc9e2a8b2c93fff49d095e7d72b
M: 1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9007
   slots:5461-5798 (0 slots) master
   1 additional replica(s)
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates e070e76789352d2492cfc9800850e943e0c4b72d
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:5799-10922 (5462 slots) master
   1 additional replica(s)
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots:10923-16383 (5461 slots) master
   1 additional replica(s)
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
# è¿™é‡Œéœ€è¦è¾“å…¥æˆ‘ä»¬æ‰€éœ€è¦çš„å“ˆå¸Œæ§½
How many slots do you want to move (from 1 to 16384)? 4097
# è¿™é‡Œéœ€è¦è¾“å…¥æˆ‘ä»¬å®ä¾‹9007çš„ID
What is the receiving node ID? 1714784542b3afc9e2a8b2c93fff49d095e7d72b
Please enter all the source node IDs.
  Type 'all' to use all the nodes as source nodes for the hash slots.
  Type 'done' once you entered all the source nodes IDs.
Source node #1:all
#è¾“å…¥all è¡¨ç¤ºä»æ‰€æœ‰çš„ä¸»èŠ‚ç‚¹ä¸­éšæœºè½¬ç§»ï¼Œå‡‘å¤Ÿ1000ä¸ªå“ˆå¸Œæ§½
#ç„¶åå†è¾“å…¥yesï¼Œredisé›†ç¾¤å°±å¼€å§‹åˆ†é…å“ˆå¸Œæ§½äº†ã€‚
</code></pre>
<p>ä»¥ä¸Š:<br>redis-trib ä¼šå‘ä½ è¯¢é—®é‡æ–°åˆ†ç‰‡çš„æºèŠ‚ç‚¹ï¼ˆsource nodeï¼‰ï¼Œå³ï¼Œè¦ä»ç‰¹ç‚¹çš„å“ªä¸ªèŠ‚ç‚¹ä¸­å–å‡º 4096 ä¸ªå“ˆå¸Œæ§½ï¼Œè¿˜æ˜¯ä»å…¨éƒ¨èŠ‚ç‚¹æå–4096ä¸ªå“ˆå¸Œæ§½ï¼Œ å¹¶å°†è¿™äº›æ§½ç§»åŠ¨åˆ°9007èŠ‚ç‚¹ä¸Šé¢ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä¸æ‰“ç®—ä»ç‰¹å®šçš„èŠ‚ç‚¹ä¸Šå–å‡ºæŒ‡å®šæ•°é‡çš„å“ˆå¸Œæ§½ï¼Œé‚£ä¹ˆå¯ä»¥å‘redis-tribè¾“å…¥ allï¼Œè¿™æ ·çš„è¯ï¼Œ é›†ç¾¤ä¸­çš„æ‰€æœ‰ä¸»èŠ‚ç‚¹éƒ½ä¼šæˆä¸ºæºèŠ‚ç‚¹ï¼Œredis-tribä»å„ä¸ªæºèŠ‚ç‚¹ä¸­å„å–å‡ºä¸€éƒ¨åˆ†å“ˆå¸Œæ§½ï¼Œå‡‘å¤Ÿ4096ä¸ªï¼Œç„¶åç§»åŠ¨åˆ°9007èŠ‚ç‚¹ä¸Šï¼š</p>
<p>éªŒè¯ï¼š</p>
<pre><code>[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb check 192.168.56.127:9001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:1280-5460 (4096 slots) master
   1 additional replica(s)
S: 5ed978b695e6a222e67d13c68e55f6c4e74b7ba6 192.168.56.127:9008
   slots: (0 slots) slave
   replicates 1714784542b3afc9e2a8b2c93fff49d095e7d72b
M: 1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9007
   slots:0-1279,5461-6998,10923-12201 (4096 slots) master
   1 additional replica(s)
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates e070e76789352d2492cfc9800850e943e0c4b72d
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:6999-10922 (4096 slots) master
   1 additional replica(s)
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots:12202-16383 (4096 slots) master
   1 additional replica(s)
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
</code></pre>
<p>ä»¥ä¸Šæˆ‘ä»¬çš„é›†ç¾¤æ­å»ºä»¥åŠæ–°å¢èŠ‚ç‚¹å°±å®Œæˆäº†ï¼›</p>
<h4 id="6-ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹"><a href="#6-ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="6. ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹:"></a>6. ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹:</h4><p>å’ŒèŠ‚ç‚¹æ·»åŠ ä¸€æ ·ï¼Œç§»é™¤èŠ‚ç‚¹ä¹Ÿæœ‰ç§»é™¤ä¸»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹</p>
<h5 id="1ã€ç§»é™¤ä¸»èŠ‚ç‚¹"><a href="#1ã€ç§»é™¤ä¸»èŠ‚ç‚¹" class="headerlink" title="1ã€ç§»é™¤ä¸»èŠ‚ç‚¹"></a>1ã€ç§»é™¤ä¸»èŠ‚ç‚¹</h5><p>ç§»é™¤èŠ‚ç‚¹ä½¿ç”¨redis-tribçš„del-nodeå‘½ä»¤</p>
<pre><code>/usr/local/redis-cluster/bin/redis-trib.rb del-node 192.168.56.127:9001 ${node-id}
</code></pre>
<p>192.168.56.127:9001å…¶ä¸­ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ï¼Œnode-idä¸ºè¦åˆ é™¤çš„ä¸»èŠ‚ç‚¹,è¿™é‡Œå’Œæ·»åŠ èŠ‚ç‚¹ä¸åŒ,ç§»é™¤èŠ‚ç‚¹node-idæ˜¯å¿…éœ€çš„ï¼Œæµ‹è¯•åˆ é™¤9003ä¸»èŠ‚ç‚¹</p>
<pre><code>[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb del-node 192.168.56.127:9001 e070e76789352d2492cfc9800850e943e0c4b72d
&gt;&gt;&gt; Removing node e070e76789352d2492cfc9800850e943e0c4b72d from cluster 192.168.56.127:9001
[ERR] Node 192.168.56.127:9003 is not empty! Reshard data away and try again.
</code></pre>
<p>redis clusteræç¤º9003å·²ç»æœ‰æ•°æ®äº†ï¼Œä¸èƒ½å¤Ÿè¢«åˆ é™¤ï¼Œéœ€è¦å°†ä»–çš„æ•°æ®è½¬ç§»å‡ºå»ï¼Œä¹Ÿå°±æ˜¯å’Œæ–°å¢ä¸»èŠ‚ç‚¹ä¸€æ ·éœ€é‡æ–°åˆ†ç‰‡ã€‚</p>
<pre><code>/usr/local/redis-cluster/bin/redis-trib.rb reshard 192.168.56.127:9001
</code></pre>
<p>æ‰§è¡Œä»¥åä¼šæç¤ºæˆ‘ä»¬ç§»é™¤çš„å¤§å°ï¼Œå› ä¸º9003å ç”¨äº†4096ä¸ªæ§½ç‚¹</p>
<pre><code>&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
How many slots do you want to move (from 1 to 16384)?
</code></pre>
<p>è¾“å…¥4096<br>æç¤ºç§»åŠ¨çš„node idï¼Œå¡«å†™9007çš„node idã€‚</p>
<pre><code>&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
How many slots do you want to move (from 1 to 16384)? 4182
What is the receiving node ID? 1714784542b3afc9e2a8b2c93fff49d095e7d72b
</code></pre>
<p>éœ€è¦ç§»åŠ¨åˆ°å…¨éƒ¨ä¸»èŠ‚ç‚¹ä¸Šè¿˜æ˜¯å•ä¸ªä¸»èŠ‚ç‚¹</p>
<pre><code>Please enter all the source node IDs.
  Type 'all' to use all the nodes as source nodes for the hash slots.
  Type 'done' once you entered all the source nodes IDs.
Source node #1:
</code></pre>
<p>å°†4096ä¸ªæ§½ç‚¹ç§»åŠ¨åˆ°9007ä¸Šï¼Œå¡«å†™9003çš„node id ï¼še070e76789352d2492cfc9800850e943e0c4b72d</p>
<pre><code>Source node #1:e070e76789352d2492cfc9800850e943e0c4b72d
Source node #2:done
</code></pre>
<p>ç¡®è®¤ä¹‹åä¼šä¸€ä¸ªä¸€ä¸ªå°†9003çš„å¡æ§½ç§»åˆ°åˆ°9007ä¸Šã€‚</p>
<pre><code>[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb check 192.168.56.127:9001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:1280-5460 (4096 slots) master
   1 additional replica(s)
S: 5ed978b695e6a222e67d13c68e55f6c4e74b7ba6 192.168.56.127:9008
   slots: (0 slots) slave
   replicates 1714784542b3afc9e2a8b2c93fff49d095e7d72b
M: 1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9007
   slots:0-1279,5461-6998,10923-16383 (8192 slots) master
   2 additional replica(s)
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates 1714784542b3afc9e2a8b2c93fff49d095e7d72b
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:6999-10922 (4096 slots) master
   1 additional replica(s)
M: e070e76789352d2492cfc9800850e943e0c4b72d 192.168.56.127:9003
   slots: (0 slots) master
   0 additional replica(s)
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
</code></pre>
<p>ä»¥ä¸Šæˆ‘ä»¬å°†å®ä¾‹9003çš„å“ˆå¸Œæ§½å…¨éƒ¨è½¬ç§»åˆ°äº†9007ï¼Œå·²ç»ä¸º0 ,æ­¤æ—¶å†æ¥åˆ é™¤æˆ‘ä»¬çš„èŠ‚ç‚¹å°±è¡Œäº†~</p>
<pre><code>[root@localhost redis-cluster]# /usr/local/redis-cluster/bin/redis-trib.rb del-node 192.168.56.127:9001 e070e76789352d2492cfc9800850e943e0c4b72d
&gt;&gt;&gt; Removing node e070e76789352d2492cfc9800850e943e0c4b72d from cluster 192.168.56.127:9001
&gt;&gt;&gt; Sending CLUSTER FORGET messages to the cluster...
&gt;&gt;&gt; SHUTDOWN the node.

# çœ‹ä¸‹é¢ç»“æœ æ‰§è¡Œå®Œdel-node 9003èŠ‚ç‚¹å°±å·²ç»ä»é›†ç¾¤ä¸­å‰”é™¤å•¦~ğŸ˜
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.56.127:9001)
M: 0fcbaa301451baf87284546513003568e47b5daa 192.168.56.127:9001
   slots:1280-5460 (4096 slots) master
   1 additional replica(s)
S: 5ed978b695e6a222e67d13c68e55f6c4e74b7ba6 192.168.56.127:9008
   slots: (0 slots) slave
   replicates 1714784542b3afc9e2a8b2c93fff49d095e7d72b
M: 1714784542b3afc9e2a8b2c93fff49d095e7d72b 192.168.56.127:9007
   slots:0-1279,5461-6998,10923-16383 (8192 slots) master
   2 additional replica(s)
S: 17db098db9fd222df002e649506f88efcdc83633 192.168.56.127:9005
   slots: (0 slots) slave
   replicates 1714784542b3afc9e2a8b2c93fff49d095e7d72b
M: 474fd53f7199ad70cce7f18bd68f5445b559509a 192.168.56.127:9002
   slots:6999-10922 (4096 slots) master
   1 additional replica(s)
S: bd278fcea63862199e964a6aab2e786710cf5575 192.168.56.127:9006
   slots: (0 slots) slave
   replicates 0fcbaa301451baf87284546513003568e47b5daa
S: 950c399165439660efb6ff2f907f938e213de530 192.168.56.127:9004
   slots: (0 slots) slave
   replicates 474fd53f7199ad70cce7f18bd68f5445b559509a
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
</code></pre>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å½“ç„¶æˆ‘ä»¬é›†ç¾¤æ­å»ºå·²ç»å®Œæˆï¼Œé‚£é›†ç¾¤çš„ä½œç”¨æ˜¯ä¸ºäº†è§£å†³åˆ†ç‰‡çš„é—®é¢˜ï¼Œå¦‚æœéœ€è¦æ­å»ºé«˜å¯ç”¨é›†ç¾¤ï¼›ä¹Ÿå°±æ˜¯ä¸»çš„å¤±è´¥åä»çš„èƒ½å¤Ÿåˆ‡æ¢è§’è‰²,<br>æ‰€ä»¥å¯ä»¥ä½¿ç”¨å“¨å…µæœºåˆ¶æ¥è§£å†³HA.<br>sentinelå’Œclusterä¸»è¦åŒºåˆ«ï¼Œsentinelç”¨æ¥è§£å†³HAï¼ˆé«˜å¯ç”¨ï¼‰é—®é¢˜ï¼Œè€Œclusterä¸»è¦è§£å†³shardingï¼ˆåˆ†ç‰‡ï¼‰é—®é¢˜ã€‚ä¸¤ä¸ªç»å¸¸ç»“åˆä½¿ç”¨æ­å»ºé«˜å¯ç”¨é›†ç¾¤ã€‚</p>
<h2 id="å…³äºå“ˆå¸Œæ§½çš„æ¦‚å¿µï¼š"><a href="#å…³äºå“ˆå¸Œæ§½çš„æ¦‚å¿µï¼š" class="headerlink" title="å…³äºå“ˆå¸Œæ§½çš„æ¦‚å¿µï¼š"></a>å…³äºå“ˆå¸Œæ§½çš„æ¦‚å¿µï¼š</h2><p>Redis é›†ç¾¤ä¸­å†…ç½®äº† 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-valueæ—¶ï¼Œredis å…ˆå¯¹ key ä½¿ç”¨ crc16 ç®—æ³•ç®—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œredis ä¼šæ ¹æ®èŠ‚ç‚¹æ•°é‡å¤§è‡´å‡ç­‰çš„å°†å“ˆå¸Œæ§½æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚</p>
<p>Redis é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash, è€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µã€‚</p>
<p>Redis é›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½,æ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½.é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚è¿™ç§ç»“æ„å¾ˆå®¹æ˜“æ·»åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ— è®ºæ˜¯æ·»åŠ åˆ é™¤æˆ–è€…ä¿®æ”¹æŸä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½ä¸ä¼šé€ æˆé›†ç¾¤ä¸å¯ç”¨çš„çŠ¶æ€ã€‚</p>
<p>ä½¿ç”¨å“ˆå¸Œæ§½çš„å¥½å¤„å°±åœ¨äºå¯ä»¥æ–¹ä¾¿çš„æ·»åŠ æˆ–ç§»é™¤èŠ‚ç‚¹ã€‚</p>
<p>å½“éœ€è¦å¢åŠ èŠ‚ç‚¹æ—¶ï¼Œåªéœ€è¦æŠŠå…¶ä»–èŠ‚ç‚¹çš„æŸäº›å“ˆå¸Œæ§½æŒªåˆ°æ–°èŠ‚ç‚¹å°±å¯ä»¥äº†ï¼›</p>
<p>å½“éœ€è¦ç§»é™¤èŠ‚ç‚¹æ—¶ï¼Œåªéœ€è¦æŠŠç§»é™¤èŠ‚ç‚¹ä¸Šçš„å“ˆå¸Œæ§½æŒªåˆ°å…¶ä»–èŠ‚ç‚¹å°±è¡Œäº†ï¼›</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬ä»¥åæ–°å¢æˆ–ç§»é™¤èŠ‚ç‚¹çš„æ—¶å€™ä¸ç”¨å…ˆåœæ‰æ‰€æœ‰çš„ redis æœåŠ¡ã€‚</p>
<p>â€œç”¨äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Œè€Œæ²¡æœ‰ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œä¸éƒ½æ˜¯å“ˆå¸Œä¹ˆï¼Ÿè¿™æ ·åšçš„åŸå› æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿâ€<br>Redis Clusteræ˜¯è‡ªå·±åšçš„crc16çš„ç®€å•hashç®—æ³•ï¼Œæ²¡æœ‰ç”¨ä¸€è‡´æ€§hashã€‚Redisçš„ä½œè€…è®¤ä¸ºå®ƒçš„crc16(key) mod 16384çš„æ•ˆæœå·²ç»ä¸é”™äº†ï¼Œè™½ç„¶æ²¡æœ‰ä¸€è‡´æ€§hashçµæ´»ï¼Œä½†å®ç°å¾ˆç®€å•ï¼ŒèŠ‚ç‚¹å¢åˆ æ—¶å¤„ç†èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</p>
<p>â€œä¸ºäº†åŠ¨æ€å¢åˆ èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸è‡³äºä¸¢å¤±æ•°æ®ä¹ˆï¼Ÿâ€<br>èŠ‚ç‚¹å¢åˆ æ—¶ä¸ä¸¢å¤±æ•°æ®å’Œhashç®—æ³•æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä¸ä¸¢å¤±æ•°æ®è¦æ±‚çš„æ˜¯ä¸€ä»½æ•°æ®æœ‰å¤šä¸ªå‰¯æœ¬ã€‚</p>
<p>â€œè¿˜æœ‰é›†ç¾¤æ€»å…±æœ‰2çš„14æ¬¡æ–¹ï¼Œ16384ä¸ªå“ˆå¸Œæ§½ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªå“ˆå¸Œæ§½ä¸­å­˜çš„key å’Œ valueæ˜¯ä»€ä¹ˆï¼Ÿâ€<br>å½“ä½ å¾€Redis Clusterä¸­åŠ å…¥ä¸€ä¸ªKeyæ—¶ï¼Œä¼šæ ¹æ®crc16(key) mod 16384è®¡ç®—è¿™ä¸ªkeyåº”è¯¥åˆ†å¸ƒåˆ°å“ªä¸ªhash slotä¸­ï¼Œä¸€ä¸ªhash slotä¸­ä¼šæœ‰å¾ˆå¤škeyå’Œvalueã€‚ä½ å¯ä»¥ç†è§£æˆè¡¨çš„åˆ†åŒºï¼Œä½¿ç”¨å•èŠ‚ç‚¹æ—¶çš„redisæ—¶åªæœ‰ä¸€ä¸ªè¡¨ï¼Œæ‰€æœ‰çš„keyéƒ½æ”¾åœ¨è¿™ä¸ªè¡¨é‡Œï¼›æ”¹ç”¨Redis Clusterä»¥åä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆ16384ä¸ªåˆ†åŒºè¡¨ï¼Œä½ insertæ•°æ®æ—¶ä¼šæ ¹æ®ä¸Šé¢çš„ç®€å•ç®—æ³•æ¥å†³å®šä½ çš„keyåº”è¯¥å­˜åœ¨å“ªä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºé‡Œæœ‰å¾ˆå¤škeyã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.sctux.cc">NoardGuo-Ops</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.sctux.cc/2017/06/04/redis-ji-qun-xiang-xi-da-jian-zhi-nan/">https://blog.sctux.cc/2017/06/04/redis-ji-qun-xiang-xi-da-jian-zhi-nan/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://blog.sctux.cc" target="_blank">OpsThoughts</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/redis-cluster/">redis-cluster</a></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/zhifubao.png" target="_blank"><img class="post-qr-code-img" src="/img/zhifubao.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2017/11/24/ru-he-shi-yongcelery-qin-cai-yi-bu-shen-qi-zhi-xin/" title="å¦‚ä½•ä½¿ç”¨Celery(èŠ¹èœ)å¼‚æ­¥ç¥å™¨æ‰§è¡Œåå°ä»»åŠ¡"><img class="cover" src="https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800&amp;h=400" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">å¦‚ä½•ä½¿ç”¨Celery(èŠ¹èœ)å¼‚æ­¥ç¥å™¨æ‰§è¡Œåå°ä»»åŠ¡</div></div><div class="info-2"><div class="info-item-1">å…³äºå¼‚æ­¥çš„çŸ¥è¯†ç½‘ä¸Šå¾ˆå¤šï¼Œè¿™é‡Œå°±ç›´æ¥ä¸Šä»£ç ï¼Œç›®å‰ç»“åˆFlaskè¿™ä¸ªPythonæ¡†æ¶å®ç°åå°ä»»åŠ¡çš„æ‰§è¡Œæ“ä½œï¼› 1.éœ€è¦äº†è§£çš„çŸ¥è¯†ç‚¹: äº†è§£ç”Ÿäº§æ¶ˆè´¹æ¨¡å‹æˆ–è€…å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ— äº†è§£å¼‚æ­¥ã€åŒæ­¥ä¹‹é—´çš„å·®åˆ«  2.å®ç°è¿‡ç¨‹(1)ç›®å½•ç»“æ„â”œâ”€â”€ LICENSE â”œâ”€â”€ README.md â”œâ”€â”€ app                     // Flask APPåº”ç”¨ â”‚&nbsp;&nbsp; â”œâ”€â”€ __init__.py  â”‚&nbsp;&nbsp; â”œâ”€â”€ auth â”‚&nbsp;&nbsp; â”œâ”€â”€ email.py â”‚&nbsp;&nbsp; â”œâ”€â”€ main â”‚&nbsp;&nbsp; â”œâ”€â”€ models.py â”‚&nbsp;&nbsp; â”œâ”€â”€ salt â”‚&nbsp;&nbsp; â”œâ”€â”€ static â”‚&nbsp;&nbsp; â””â”€â”€ templates â”œâ”€â”€ config.py               // é€šç”¨é…ç½® â”œâ”€â”€ config.pyc â”œâ”€â”€ manager.py â”œâ”€â”€ migrations â”‚&nbsp;&nbsp; â”œâ”€â”€ READM...</div></div></div></a><a class="pagination-related" href="/2017/05/31/lan-jing-ping-tai-shi-jian-ji-ying-yong-2/" title="è“é²¸å¹³å°å®è·µåŠåº”ç”¨..."><img class="cover" src="https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&amp;h=400" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">è“é²¸å¹³å°å®è·µåŠåº”ç”¨...</div></div><div class="info-2"><div class="info-item-1">å‰è¨€:åœ¨ä»Šå¹´ä¸‰æœˆä»½è“é²¸æ¨å‡ºäº†ä¸€å¥—å…è´¹çš„è“é²¸DevOpsæŠ€èƒ½åŸ¹è®­ï¼Œå€ŸåŠ©è“é²¸å¹³å°è‡´åŠ›äºè®©æ¯ä¸ªè¿ç»´å±Œä¸éƒ½å…·å¤‡ä¸€å®šçš„å¼€å‘èƒ½åŠ›ï¼›æœ‰å¹¸åœ¨æ­¤æ¬¡åŸ¹è®­è¯¾ç¨‹åšæŒäº†ä¸‹æ¥ï¼Œä¹Ÿæ”¶è·äº†å…³äºè…¾è®¯è“é²¸è¿ç»´çš„ä¸€äº›ç†å¿µã€æ€ç»´ï¼›åŒæ—¶è‡ªå·±çš„å·¥ä½œæ–¹å¼ã€å­¦ä¹ æ–¹å¼ä¹Ÿæœ‰äº†ä¸€å®šçš„æå‡ã€æ”¹å˜ï¼›å†æ­¤æ„Ÿè°¢å„ä½å¯¼å¸ˆçš„å­œå­œä¸å€¦çš„æ•™æˆâ€”â€“æˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”ã€‚  ä¸€ã€å¦‚ä½•å­¦ä¹ å®ƒï¼Ÿ LinuxåŸºç¡€(å¿…å¤‡)ï¼› éœ€è¦æœ‰ä¸€å®šçš„PythonåŸºç¡€çŸ¥è¯†ï¼› å‰ç«¯æ–¹é¢ä¹Ÿéœ€è¦å¤šå†™ï¼› å­¦ä¹ èƒ½åŠ› + å­¦ä¹ æ–¹æ³•ï¼›   äºŒã€å­¦ä¹ é€”å¾„ï¼šé“¾æ¥: è“é²¸DevOpsæŠ€èƒ½åŸ¹è®­  ä¸‰ã€æˆ‘çš„å­¦ä¹ è®°å½•:é“¾æ¥: ä½œä¸šè®°å½•  å››ã€ç›®å‰å­¦ä¹ æˆæœ: è“é²¸paaså¹³å°é¡µé¢æˆªå›¾:  è“é²¸å¼€å‘è€…ä¸­å¿ƒ: ï¿¼ è‡ªä¸»å¼€å‘Appæƒé™æ§åˆ¶å¹³å°: ï¿¼ è‡ªä¸»å¼€å‘è¿ç»´ç®¡æ§å¹³å°: ï¿¼   äº”ã€å°ç»“:ä¸Šé¢çš„ä¸¤ä¸ªåº”ç”¨å·²ç»åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒ;å…¶ä»–å„ä¸ªéƒ¨é—¨çš„å¹³å°å¼€å‘ing;ç°åœ¨å°ä¼™ä¼´å„¿ä»¬å¦‚æœå»å­¦ä¹ çš„è¯ï¼›åº”è¯¥éå¸¸çš„é¡ºåˆ©ï¼Œæ¯•ç«Ÿå‘å·®ä¸å¤šéƒ½è¢«å¡«å®Œäº†ã€‚ä¸æƒ³è¯´å¤ªå¤šï¼›æ­¤ç¯‡åšæ–‡è®°å½•ä¸€ä¸‹è¿™ä¸‰ä¸ªæœˆä»¥æ¥çš„ä¸€äº›æ”¶è·å§;ï¿¼ ä½ çš„å¯¹æ‰‹åœ¨çœ‹ä¹¦ï¼Œä½ çš„ä»‡äººåœ¨ç£¨åˆ€ï¼Œä½ çš„é—ºå¯†åœ¨å‡è‚¥ï¼Œéš”å£è€ç‹åœ¨ç»ƒè…°ï¼Œæˆ‘ä»¬å¿…é¡»ä¸æ–­å­¦ä¹ ï¼Œæ‰èƒ½è®©è‡ªå·±å˜å¾—æ›´å¼ºã€‚</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">NoardGuo-Ops</div><div class="author-info-description">Happiness is not something ready-made. It comes from your own actionsğŸ’ªğŸ».</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">93</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">30</div></a></div><a id="card-info-btn" href="https://github.com/guomaoqiu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/guomaoqiu" target="_blank" title="Github"><i class="fab fa-github" style="color: #b9410e;"></i></a><a class="social-icon" href="mailto:guomaoqiu@icloud.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #663399;"></i></a><a class="social-icon" href="https://t.me/noardguo_devops" target="_blank" title="TG"><i class="fa-brands fa-telegram" style="color: #00ff99;"></i></a><a class="social-icon" href="weixin://NoardGuo-Ops" target="_blank" title="WeChat"><i class="fa-brands fa-weixin" style="color: #b197fc;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E9%9B%86%E7%BE%A4%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Redis é›†ç¾¤ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%8F%E9%9A%8F%E4%BE%BF%E4%BE%BF%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%9B%86%E7%BE%A4"><span class="toc-number">2.</span> <span class="toc-text">éšéšä¾¿ä¾¿æ­å»ºä¸€ä¸ªé›†ç¾¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">2.0.1.</span> <span class="toc-text">1.è·å–è½¯ä»¶åŒ…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%A7%84%E5%88%92%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.è§„åˆ’åˆ›å»ºæ–‡ä»¶ç›®å½•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%A4%8D%E5%88%B6%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="toc-number">2.0.3.</span> <span class="toc-text">3. å¤åˆ¶æ‰§è¡Œè„šæœ¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%A4%8D%E5%88%B6%E4%B8%80%E4%B8%AA%E6%96%B0-Redis-%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.0.4.</span> <span class="toc-text">4.å¤åˆ¶ä¸€ä¸ªæ–° Redis å®ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%86%8D%E5%A4%8D%E5%88%B6%E5%87%BA%E4%BA%94%E4%B8%AA%E6%96%B0-Redis-%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.0.5.</span> <span class="toc-text">5.å†å¤åˆ¶å‡ºäº”ä¸ªæ–° Redis å®ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E6%89%80%E9%9C%80%E8%BD%AF%E4%BB%B6"><span class="toc-number">2.0.6.</span> <span class="toc-text">6.å®‰è£…é›†ç¾¤æ‰€éœ€è½¯ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E5%88%A9%E7%94%A8%E5%AE%98%E6%96%B9%E6%8F%90%E4%BE%9B%E7%9A%84%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="toc-number">2.0.7.</span> <span class="toc-text">7. åˆ©ç”¨å®˜æ–¹æä¾›çš„å‘½ä»¤åˆ›å»ºé›†ç¾¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%96%B0%E5%A2%9E%E8%8A%82%E7%82%B9%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">å¦‚ä½•æ–°å¢èŠ‚ç‚¹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%90%AF%E5%8A%A8%E4%B8%A4%E4%B8%AA%E5%AE%9E%E4%BE%8B-%E5%81%87%E8%AE%BE%E6%88%91%E8%BF%99%E9%87%8C%E5%B7%B2%E7%BB%8F%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BF%AE%E6%94%B9%E5%AE%8C%E9%85%8D%E7%BD%AE%E4%BA%86"><span class="toc-number">3.0.1.</span> <span class="toc-text">1.å¯åŠ¨ä¸¤ä¸ªå®ä¾‹(å‡è®¾æˆ‘è¿™é‡Œå·²ç»å¤åˆ¶é…ç½®ï¼Œä¿®æ”¹å®Œé…ç½®äº†)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%AE%9E%E4%BE%8B%E5%88%B0%E9%9B%86%E7%BE%A4"><span class="toc-number">3.0.2.</span> <span class="toc-text">2.æ·»åŠ å®ä¾‹åˆ°é›†ç¾¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A2%9E%E5%8A%A0%E5%AE%9E%E4%BE%8B%E7%9A%84%E4%BB%8E%E8%8A%82%E7%82%B9%E5%88%B0%E9%9B%86%E7%BE%A4"><span class="toc-number">3.0.3.</span> <span class="toc-text">5. å¢åŠ å®ä¾‹çš„ä»èŠ‚ç‚¹åˆ°é›†ç¾¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%BB%8E%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="toc-number">3.0.4.</span> <span class="toc-text">6. ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹:</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E7%A7%BB%E9%99%A4%E4%B8%BB%E8%8A%82%E7%82%B9"><span class="toc-number">3.0.4.1.</span> <span class="toc-text">1ã€ç§»é™¤ä¸»èŠ‚ç‚¹</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">4.</span> <span class="toc-text">æœ€å</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%93%88%E5%B8%8C%E6%A7%BD%E7%9A%84%E6%A6%82%E5%BF%B5%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">å…³äºå“ˆå¸Œæ§½çš„æ¦‚å¿µï¼š</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/04/%E6%B1%82%E8%81%8C%E5%B8%96/" title="æ±‚èŒ-ç³»ç»Ÿè¿ç»´/SREæ–¹å‘"><img src="https://images.unsplash.com/photo-1590650516494-0c8e4a4dd67b?w=800&amp;h=400" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ±‚èŒ-ç³»ç»Ÿè¿ç»´/SREæ–¹å‘"/></a><div class="content"><a class="title" href="/2025/09/04/%E6%B1%82%E8%81%8C%E5%B8%96/" title="æ±‚èŒ-ç³»ç»Ÿè¿ç»´/SREæ–¹å‘">æ±‚èŒ-ç³»ç»Ÿè¿ç»´/SREæ–¹å‘</a><time datetime="2025-09-03T16:01:01.000Z" title="å‘è¡¨äº 2025-09-04 00:01:01">2025-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/Docker%E6%9E%84%E5%BB%BA%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%B9%B3%E5%8F%B0EFK-TLS/" title="Dockeræ„å»ºæ—¥å¿—æ”¶é›†å¹³å°EFK(TLS)"><img src="https://images.unsplash.com/photo-1590650516494-0c8e4a4dd67b?w=800&amp;h=400" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dockeræ„å»ºæ—¥å¿—æ”¶é›†å¹³å°EFK(TLS)"/></a><div class="content"><a class="title" href="/2024/07/23/Docker%E6%9E%84%E5%BB%BA%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%B9%B3%E5%8F%B0EFK-TLS/" title="Dockeræ„å»ºæ—¥å¿—æ”¶é›†å¹³å°EFK(TLS)">Dockeræ„å»ºæ—¥å¿—æ”¶é›†å¹³å°EFK(TLS)</a><time datetime="2024-07-23T01:56:27.000Z" title="å‘è¡¨äº 2024-07-23 09:56:27">2024-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/16/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8ElastAlert2%E5%AF%B9ES%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97%E5%88%9B%E5%BB%BA%E5%91%8A%E8%AD%A6/" title="å¦‚ä½•åˆ©ç”¨ElastAlert2å¯¹ESä¸­çš„æ—¥å¿—åˆ›å»ºå‘Šè­¦"><img src="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&amp;h=400" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å¦‚ä½•åˆ©ç”¨ElastAlert2å¯¹ESä¸­çš„æ—¥å¿—åˆ›å»ºå‘Šè­¦"/></a><div class="content"><a class="title" href="/2024/07/16/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8ElastAlert2%E5%AF%B9ES%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97%E5%88%9B%E5%BB%BA%E5%91%8A%E8%AD%A6/" title="å¦‚ä½•åˆ©ç”¨ElastAlert2å¯¹ESä¸­çš„æ—¥å¿—åˆ›å»ºå‘Šè­¦">å¦‚ä½•åˆ©ç”¨ElastAlert2å¯¹ESä¸­çš„æ—¥å¿—åˆ›å»ºå‘Šè­¦</a><time datetime="2024-07-16T09:56:39.000Z" title="å‘è¡¨äº 2024-07-16 17:56:39">2024-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/09/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Python%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89pod%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81/" title="å¦‚ä½•åˆ©ç”¨Pythonè·å–æ‰€æœ‰podå®¹å™¨çŠ¶æ€"><img src="https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&amp;h=400" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å¦‚ä½•åˆ©ç”¨Pythonè·å–æ‰€æœ‰podå®¹å™¨çŠ¶æ€"/></a><div class="content"><a class="title" href="/2024/07/09/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Python%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89pod%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81/" title="å¦‚ä½•åˆ©ç”¨Pythonè·å–æ‰€æœ‰podå®¹å™¨çŠ¶æ€">å¦‚ä½•åˆ©ç”¨Pythonè·å–æ‰€æœ‰podå®¹å™¨çŠ¶æ€</a><time datetime="2024-07-09T09:38:00.000Z" title="å‘è¡¨äº 2024-07-09 17:38:00">2024-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/10/K8S%E4%B8%ADMySQL%E4%BD%BF%E7%94%A8NFS%E6%8C%82%E8%BD%BD%E7%9A%84%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" title="K8Sä¸­MySQLä½¿ç”¨NFSæŒ‚è½½çš„å¼‚å¸¸é—®é¢˜å¤„ç†"><img src="https://images.unsplash.com/photo-1573164713714-d95e436ab8d6?w=800&amp;h=400" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8Sä¸­MySQLä½¿ç”¨NFSæŒ‚è½½çš„å¼‚å¸¸é—®é¢˜å¤„ç†"/></a><div class="content"><a class="title" href="/2024/05/10/K8S%E4%B8%ADMySQL%E4%BD%BF%E7%94%A8NFS%E6%8C%82%E8%BD%BD%E7%9A%84%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" title="K8Sä¸­MySQLä½¿ç”¨NFSæŒ‚è½½çš„å¼‚å¸¸é—®é¢˜å¤„ç†">K8Sä¸­MySQLä½¿ç”¨NFSæŒ‚è½½çš„å¼‚å¸¸é—®é¢˜å¤„ç†</a><time datetime="2024-05-10T12:58:02.000Z" title="å‘è¡¨äº 2024-05-10 20:58:02">2024-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/12/Prometheus-Consul%E5%AE%9E%E7%8E%B0%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%BF%E4%B8%BB%E6%9C%BA-%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/" title="Prometheus+Consulå®ç°ä¼ä¸šçº§å®¿ä¸»æœº+å®¹å™¨ç›‘æ§å‘Šè­¦"><img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&amp;h=400" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Prometheus+Consulå®ç°ä¼ä¸šçº§å®¿ä¸»æœº+å®¹å™¨ç›‘æ§å‘Šè­¦"/></a><div class="content"><a class="title" href="/2022/09/12/Prometheus-Consul%E5%AE%9E%E7%8E%B0%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%BF%E4%B8%BB%E6%9C%BA-%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/" title="Prometheus+Consulå®ç°ä¼ä¸šçº§å®¿ä¸»æœº+å®¹å™¨ç›‘æ§å‘Šè­¦">Prometheus+Consulå®ç°ä¼ä¸šçº§å®¿ä¸»æœº+å®¹å™¨ç›‘æ§å‘Šè­¦</a><time datetime="2022-09-12T06:45:26.000Z" title="å‘è¡¨äº 2022-09-12 14:45:26">2022-09-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800&amp;h=400);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2013 - 2025 By NoardGuo-Ops</span><span class="framework-info"><span>æ¡†æ¶ </span><a href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div><div class="footer_custom_text">Hi, welcome to my <a href="https://blog.sctux.cc/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>