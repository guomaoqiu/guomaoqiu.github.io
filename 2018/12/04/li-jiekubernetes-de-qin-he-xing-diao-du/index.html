<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ç†è§£Kubernetesçš„äº²å’Œæ€§è°ƒåº¦ | OpsThoughts</title><meta name="author" content="NoardGuo-Ops"><meta name="copyright" content="NoardGuo-Ops"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NodeNameã€nodeSelectorã€nodeAffinityã€podAffinityã€Taintsä»¥åŠTolerationsç”¨æ³• 1. NodeNamePod.spec.nodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Šï¼Œè¿™é‡Œè¯´æ˜¯â€œè°ƒåº¦â€ï¼Œä½†å…¶å®æŒ‡å®šäº†nodeNameçš„Podä¼šç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å†™å…¥PodListåˆ—è¡¨ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶åŒ¹é…ã€‚ä¾‹å­ï¼šæˆ‘çš„é¢„æœŸ">
<meta property="og:type" content="article">
<meta property="og:title" content="ç†è§£Kubernetesçš„äº²å’Œæ€§è°ƒåº¦">
<meta property="og:url" content="https://blog.sctux.cc/2018/12/04/li-jiekubernetes-de-qin-he-xing-diao-du/index.html">
<meta property="og:site_name" content="OpsThoughts">
<meta property="og:description" content="NodeNameã€nodeSelectorã€nodeAffinityã€podAffinityã€Taintsä»¥åŠTolerationsç”¨æ³• 1. NodeNamePod.spec.nodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Šï¼Œè¿™é‡Œè¯´æ˜¯â€œè°ƒåº¦â€ï¼Œä½†å…¶å®æŒ‡å®šäº†nodeNameçš„Podä¼šç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å†™å…¥PodListåˆ—è¡¨ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶åŒ¹é…ã€‚ä¾‹å­ï¼šæˆ‘çš„é¢„æœŸ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.sctux.cc/img/butterfly-icon.png">
<meta property="article:published_time" content="2018-12-04T15:53:16.000Z">
<meta property="article:modified_time" content="2025-09-01T01:59:08.920Z">
<meta property="article:author" content="NoardGuo-Ops">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.sctux.cc/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ç†è§£Kubernetesçš„äº²å’Œæ€§è°ƒåº¦",
  "url": "https://blog.sctux.cc/2018/12/04/li-jiekubernetes-de-qin-he-xing-diao-du/",
  "image": "https://blog.sctux.cc/img/butterfly-icon.png",
  "datePublished": "2018-12-04T15:53:16.000Z",
  "dateModified": "2025-09-01T01:59:08.920Z",
  "author": [
    {
      "@type": "Person",
      "name": "NoardGuo-Ops",
      "url": "https://blog.sctux.cc"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.sctux.cc/2018/12/04/li-jiekubernetes-de-qin-he-xing-diao-du/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ç†è§£Kubernetesçš„äº²å’Œæ€§è°ƒåº¦',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="OpsThoughts" type="application/atom+xml">
</head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">OpsThoughts</span></a><a class="nav-page-title" href="/"><span class="site-name">ç†è§£Kubernetesçš„äº²å’Œæ€§è°ƒåº¦</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">ç†è§£Kubernetesçš„äº²å’Œæ€§è°ƒåº¦</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2018-12-04T15:53:16.000Z" title="å‘è¡¨äº 2018-12-04 23:53:16">2018-12-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-09-01T01:59:08.920Z" title="æ›´æ–°äº 2025-09-01 09:59:08">2025-09-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Docker/">Docker</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><code>NodeNameã€nodeSelectorã€nodeAffinityã€podAffinityã€Taintsä»¥åŠTolerationsç”¨æ³•</code></p>
<h2 id="1-NodeName"><a href="#1-NodeName" class="headerlink" title="1. NodeName"></a>1. NodeName</h2><p>Pod.spec.nodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Šï¼Œè¿™é‡Œè¯´æ˜¯â€œè°ƒåº¦â€ï¼Œä½†å…¶å®æŒ‡å®šäº†nodeNameçš„Podä¼šç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å†™å…¥PodListåˆ—è¡¨ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯<code>å¼ºåˆ¶åŒ¹é…</code>ã€‚<br>ä¾‹å­ï¼š<br>æˆ‘çš„é¢„æœŸæ˜¯å°†è¯¥podè¿è¡ŒäºèŠ‚ç‚¹åç§°ä¸º 192.168.56.11 è¿™ä¸ªèŠ‚ç‚¹ï¼š</p>
<h6 id="1-1-ä¾‹å¦‚-test-nodename-yaml"><a href="#1-1-ä¾‹å¦‚-test-nodename-yaml" class="headerlink" title="1.1 ä¾‹å¦‚(test-nodename.yaml)"></a>1.1 ä¾‹å¦‚(test-nodename.yaml)</h6><pre><code>apiVersion: v1
kind: Pod
metadata:
  labels:
    app: with-nodename-busybox-pod
  name: with-nodename
spec:
  nodeName: 192.168.56.11 #é€šè¿‡è¿™é‡ŒæŒ‡å®š
  containers:
  - command:
    - sleep
    - "3600"
    image: busybox
    imagePullPolicy: IfNotPresent
    name: test-busybox
</code></pre>
<h6 id="1-2-æŸ¥çœ‹åˆ›å»ºäº‹ä»¶ã€ä¸é¢„æœŸç›¸ç¬¦"><a href="#1-2-æŸ¥çœ‹åˆ›å»ºäº‹ä»¶ã€ä¸é¢„æœŸç›¸ç¬¦" class="headerlink" title="1.2 æŸ¥çœ‹åˆ›å»ºäº‹ä»¶ã€ä¸é¢„æœŸç›¸ç¬¦:"></a>1.2 æŸ¥çœ‹åˆ›å»ºäº‹ä»¶ã€ä¸é¢„æœŸç›¸ç¬¦:</h6><pre><code>Events:
  Type    Reason                 Age   From                    Message
  ----    ------                 ----  ----                    -------
  Normal  Scheduled              3m    default-scheduler       Successfully assigned with-pod-affinity to 192.168.56.11
  Normal  SuccessfulMountVolume  3m    kubelet, 192.168.56.11  MountVolume.SetUp succeeded for volume "default-token-5htws"
  Normal  Pulling                3m    kubelet, 192.168.56.11  pulling image "nginx"
  Normal  Pulled                 1m    kubelet, 192.168.56.11  Successfully pulled image "nginx"
  Normal  Created                1m    kubelet, 192.168.56.11  Created container
  Normal  Started                1m    kubelet, 192.168.56.11  Started container
</code></pre>
<h2 id="2-NodeSelector"><a href="#2-NodeSelector" class="headerlink" title="2. NodeSelector"></a>2. NodeSelector</h2><p>Pod.spec.nodeSelectoræ˜¯é€šè¿‡kubernetesçš„label-selectoræœºåˆ¶è¿›è¡ŒèŠ‚ç‚¹é€‰æ‹©ï¼Œç”±schedulerè°ƒåº¦ç­–ç•¥MatchNodeSelectorè¿›è¡ŒlabelåŒ¹é…ï¼Œè°ƒåº¦podåˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯<code>å¼ºåˆ¶çº¦æŸ</code>ã€‚ä½¿ç”¨èŠ‚ç‚¹é€‰æ‹©å™¨çš„æ­¥éª¤ä¸ºï¼š</p>
<h6 id="2-1-Nodeæ·»åŠ labelæ ‡è®°-æ ‡è®°è§„åˆ™ï¼š"><a href="#2-1-Nodeæ·»åŠ labelæ ‡è®°-æ ‡è®°è§„åˆ™ï¼š" class="headerlink" title="2.1 Nodeæ·»åŠ labelæ ‡è®°,æ ‡è®°è§„åˆ™ï¼š"></a>2.1 Nodeæ·»åŠ labelæ ‡è®°,æ ‡è®°è§„åˆ™ï¼š</h6><pre><code>kubectl label nodes &lt;node-name&gt; &lt;label-key&gt;=&lt;label-value&gt;
kubectl label nodes 192.168.56.14 server_type=game_server
</code></pre>
<h6 id="2-2-ç¡®è®¤æ ‡è®°"><a href="#2-2-ç¡®è®¤æ ‡è®°" class="headerlink" title="2.2 ç¡®è®¤æ ‡è®°"></a>2.2 ç¡®è®¤æ ‡è®°</h6><pre><code>[root@linux-node1 ~]# kubectl get nodes 192.168.56.14 --show-labels
NAME            STATUS    ROLES     AGE       VERSION   LABELS
192.168.56.14   Ready     node      82d       v1.10.1   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=192.168.56.14,node-role.kubernetes.io/node=true,server_type=game_server
</code></pre>
<h6 id="2-3-ä¾‹å¦‚-test-nodeselector-yaml"><a href="#2-3-ä¾‹å¦‚-test-nodeselector-yaml" class="headerlink" title="2.3 ä¾‹å¦‚(test-nodeselector.yaml)"></a>2.3 ä¾‹å¦‚(test-nodeselector.yaml)</h6><pre><code>apiVersion: v1
kind: Pod
metadata:
  labels:
    app: with-nodeselector-busybox-pod
  name: with-node-selector
spec:
  containers:
  - command:
    - sleep
    - "3600"
    image: busybox
    imagePullPolicy: IfNotPresent
    name: test-busybox
  # é€šè¿‡èŠ‚ç‚¹æ ‡ç­¾è¿›è¡Œé¢„è®¾è¯¥podå°†ä¼šè¿è¡Œäºæœ‰æ­¤æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šé¢ï¼Œ
  # å¦‚æœå¤šä¸ªèŠ‚ç‚¹æ‹¥æœ‰æ­¤æ ‡ç­¾ï¼Œè°ƒåº¦å™¨å°†ä¼šæ‹©ä¼˜è¿›è¡Œè°ƒåº¦
  nodeSelector:
    server_type: game_server
</code></pre>
<h5 id="2-4-æŸ¥çœ‹åˆ›å»ºäº‹ä»¶"><a href="#2-4-æŸ¥çœ‹åˆ›å»ºäº‹ä»¶" class="headerlink" title="2.4 æŸ¥çœ‹åˆ›å»ºäº‹ä»¶:"></a>2.4 æŸ¥çœ‹åˆ›å»ºäº‹ä»¶:</h5><pre><code>Events:
  Type    Reason                 Age   From                    Message
  ----    ------                 ----  ----                    -------
  Normal  Scheduled              16s   default-scheduler       Successfully assigned with-node-selector to 192.168.56.14
  Normal  SuccessfulMountVolume  16s   kubelet, 192.168.56.14  MountVolume.SetUp succeeded for volume "default-token-5htws"
  Normal  Pulling                11s   kubelet, 192.168.56.14  pulling image "busybox"
</code></pre>
<p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ„Ÿå—åˆ°nodeSelectorçš„æ–¹å¼æ¯”è¾ƒç›´è§‚ï¼Œä½†æ˜¯è¿˜å¤Ÿçµæ´»ï¼Œæ§åˆ¶ç²’åº¦åå¤§ï¼Œä¸‹é¢æˆ‘ä»¬å†çœ‹å¦å¤–ä¸€ç§æ›´åŠ çµæ´»çš„æ–¹å¼ï¼š<code>nodeAffinity</code>ã€‚</p>
<h2 id="3-NodeAffinity"><a href="#3-NodeAffinity" class="headerlink" title="3. NodeAffinity"></a>3. NodeAffinity</h2><p><code>nodeAffinity</code>å°±æ˜¯èŠ‚ç‚¹äº²å’Œæ€§ï¼Œç›¸å¯¹åº”çš„æ˜¯<code>Anti-Affinity</code>ï¼Œå°±æ˜¯åäº²å’Œæ€§ï¼Œè¿™ç§æ–¹æ³•æ¯”ä¸Šé¢çš„nodeSelectoræ›´åŠ çµæ´»ï¼Œå®ƒå¯ä»¥è¿›è¡Œä¸€äº›ç®€å•çš„é€»è¾‘ç»„åˆäº†ï¼Œä¸åªæ˜¯ç®€å•çš„ç›¸ç­‰åŒ¹é…ã€‚<br>è°ƒåº¦å¯ä»¥åˆ†æˆè½¯ç­–ç•¥å’Œç¡¬ç­–ç•¥ä¸¤ç§æ–¹å¼ï¼Œè½¯ç­–ç•¥å°±æ˜¯å¦‚æœä½ æ²¡æœ‰æ»¡è¶³è°ƒåº¦è¦æ±‚çš„èŠ‚ç‚¹çš„è¯ï¼ŒPOD å°±ä¼šå¿½ç•¥è¿™æ¡è§„åˆ™ï¼Œç»§ç»­å®Œæˆè°ƒåº¦è¿‡ç¨‹ã€‚ <code>nodeAffinity</code>å°±æœ‰ä¸¤ä¸Šé¢ä¸¤ç§ç­–ç•¥ï¼š</p>
<pre><code># è½¯ç­–ç•¥:(æ»¡è¶³æ¡ä»¶æœ€å¥½äº†ï¼Œæ²¡æœ‰çš„è¯ä¹Ÿæ— æ‰€è°“äº†çš„ç­–ç•¥)
preferredDuringSchedulingIgnoredDuringExecution
# ç¡¬ç­–ç•¥:(ä½ å¿…é¡»æ»¡è¶³æˆ‘çš„è¦æ±‚ï¼Œä¸ç„¶æˆ‘å°±ä¸å¹²)
requiredDuringSchedulingIgnoredDuringExecution
</code></pre>
<h6 id="3-1-ä¾‹å¦‚-test-node-affinity-yaml"><a href="#3-1-ä¾‹å¦‚-test-node-affinity-yaml" class="headerlink" title="3.1 ä¾‹å¦‚(test-node-affinity.yaml)"></a>3.1 ä¾‹å¦‚(test-node-affinity.yaml)</h6><pre><code>apiVersion: v1
kind: Pod
metadata:
  name: with-node-affinity
  labels:
    app: node-affinity-pod
spec:
  containers:
  - name: with-node-affinity
    image: nginx
    imagePullPolicy: IfNotPresent
  affinity:
    nodeAffinity:
      # ç¡¬æ€§ç­–ç•¥
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/hostname
            operator: NotIn
            values:
            - 192.168.56.11
            - 192.168.56.12
      # è½¯æ€§ç­–ç•¥
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 1
        preference:
          matchExpressions:
          - key: server_type
            operator: In
            values:
              - game_server
</code></pre>
<p>ä¸Šé¢çš„Podæˆ‘ä»¬è¿›è¡Œä¸€ä¸‹è§£è¯»:<br>1ã€è¯¥pod é€šè¿‡ç¡¬æ€§ç­–ç•¥çº¦æŸåå°†ç¦æ­¢è°ƒåº¦åˆ°èŠ‚ç‚¹11ï¼Œ12ä¸Šé¢å»<br>2ã€æ’é™¤èŠ‚ç‚¹11ï¼Œ12åï¼Œé€‰æ‹©å…¶ä»–èŠ‚ç‚¹å«æœ‰labelä¸º<code>server_type:game_server</code>çš„èŠ‚ç‚¹è¿è¡Œ<br>3ã€å¦‚æœå…¶ä»–èŠ‚ç‚¹ä¹Ÿæ²¡æœ‰å«æœ‰label <code>server_type:game_server</code>, é‚£ä¹ˆå°†ä¼šè°ƒåº¦åˆ°ä»»æ„èŠ‚ç‚¹è¿è¡Œ<br>åŒæ ·çš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨descirbeå‘½ä»¤æŸ¥çœ‹å…·ä½“çš„è°ƒåº¦æƒ…å†µæ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚è¿™é‡Œçš„åŒ¹é…é€»è¾‘æ˜¯ label çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­ï¼Œç°åœ¨Kubernetesæä¾›çš„æ“ä½œç¬¦æœ‰ä¸‹é¢çš„å‡ ç§ï¼š</p>
<ul>
<li>Inï¼šlabel çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­</li>
<li>NotInï¼šlabel çš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­</li>
<li>Gtï¼šlabel çš„å€¼å¤§äºæŸä¸ªå€¼</li>
<li>Ltï¼šlabel çš„å€¼å°äºæŸä¸ªå€¼</li>
<li>Existsï¼šæŸä¸ª label å­˜åœ¨</li>
<li>DoesNotExistï¼šæŸä¸ª label ä¸å­˜åœ¨</li>
</ul>
<p>å¦‚æœ<code>nodeSelectorTerms</code>ä¸‹é¢æœ‰å¤šä¸ªé€‰é¡¹çš„è¯ï¼Œæ»¡è¶³ä»»ä½•ä¸€ä¸ªæ¡ä»¶å°±å¯ä»¥äº†ï¼›å¦‚æœ<code>matchExpressions</code>æœ‰å¤šä¸ªé€‰é¡¹çš„è¯ï¼Œåˆ™å¿…é¡»åŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶æ‰èƒ½æ­£å¸¸è°ƒåº¦ PODã€‚</p>
<h2 id="4-PodAffinity"><a href="#4-PodAffinity" class="headerlink" title="4. PodAffinity"></a>4. PodAffinity</h2><p>ä¸Šé¢ä¸‰ç§æ–¹å¼éƒ½æ˜¯è®©PODå»é€‰æ‹©èŠ‚ç‚¹çš„ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½å¤Ÿæ ¹æ® POD ä¹‹é—´çš„å…³ç³»è¿›è¡Œè°ƒåº¦ï¼ŒKubernetesåœ¨1.4ç‰ˆæœ¬å¼•å…¥çš„podAffinityæ¦‚å¿µå°±å¯ä»¥å®ç°æˆ‘ä»¬è¿™ä¸ªéœ€æ±‚ã€‚</p>
<p>å’Œ<code>nodeAffinity</code>ç±»ä¼¼ï¼Œ<code>podAffinity</code>ä¹Ÿæœ‰<code>requiredDuringSchedulingIgnoredDuringExecution(ç¡¬æ€§ç­–ç•¥)</code>å’Œ <code>preferredDuringSchedulingIgnoredDuringExecution(è½¯æ€§ç­–ç•¥)</code>ä¸¤ç§è°ƒåº¦ç­–ç•¥ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å¦‚æœè¦ä½¿ç”¨äº’æ–¥æ€§ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>podAntiAffinity</code>å­—æ®µã€‚ å¦‚ä¸‹ä¾‹å­ï¼Œæˆ‘ä»¬å¸Œæœ›ã€with-pod-affinityã€‘å’Œã€with-nodename-busybox-podã€‘èƒ½å¤Ÿå°±è¿‘éƒ¨ç½²ï¼Œè€Œä¸å¸Œæœ›å’Œã€node-affinity-podã€‘éƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸‹é¢ï¼š</p>
<h6 id="4-1-ä¾‹å¦‚-test-pod-affinity-yaml"><a href="#4-1-ä¾‹å¦‚-test-pod-affinity-yaml" class="headerlink" title="4.1 ä¾‹å¦‚(test-pod-affinity.yaml)"></a>4.1 ä¾‹å¦‚(test-pod-affinity.yaml)</h6><pre><code>apiVersion: v1
kind: Pod
metadata:
  name: with-pod-affinity
  labels:
    app: pod-affinity-pod
spec:
  containers:
  - name: with-pod-affinity
    image: nginx
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app
            operator: In
            values:
            - with-nodename-busybox-pod
        topologyKey: kubernetes.io/hostname
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 1
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app
              operator: In
              values:
              - node-affinity-pod
          topologyKey: kubernetes.io/hostname
</code></pre>
<p>ä¸Šé¢çš„podæˆ‘ä»¬è§£è¯»ä¸€ä¸‹:<br>1ã€POD éœ€è¦è°ƒåº¦åˆ°æŸä¸ªæŒ‡å®šçš„ä¸»æœºä¸Šï¼Œè‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œäº†è¿™æ ·çš„ PODï¼šè¿™ä¸ª POD æœ‰ä¸€ä¸ª<code>app=busybox-pod</code>çš„ labelã€‚<br>2ã€<code>podAntiAffinity</code>åˆ™æ˜¯å¸Œæœ›æœ€å¥½ä¸è¦è°ƒåº¦åˆ°è¿™æ ·çš„èŠ‚ç‚¹ï¼šè¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œäº†æŸä¸ª PODï¼Œè€Œè¿™ä¸ª POD æœ‰app=node-affinity-podçš„ labelã€‚<br>3ã€æ ¹æ®å‰é¢ä¸¤ä¸ª POD çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥é¢„è§ä¸Šé¢è¿™ä¸ª POD åº”è¯¥ä¼šè¢«è°ƒåº¦åˆ°192.168.56.11çš„èŠ‚ç‚¹ä¸Šï¼Œå› ä¸ºå‰é¢å®è·µçš„æ—¶å€™ã€with-nodename-busybox-podã€‘è¢«è°ƒåº¦åˆ°äº†192.168.56.11èŠ‚ç‚¹ï¼Œè€Œã€node-affinity-podã€‘è¢«è°ƒåº¦åˆ°äº†192.168.56.11ä»¥ä¸ºçš„èŠ‚ç‚¹ï¼Œæ­£å¥½æ»¡è¶³ä¸Šé¢çš„éœ€æ±‚ã€‚<br>é€šè¿‡describeæŸ¥çœ‹ï¼š</p>
<pre><code>Events:
  Type    Reason                 Age   From                    Message
  ----    ------                 ----  ----                    -------
  Normal  Scheduled              53m   default-scheduler       Successfully assigned with-pod-affinity to 192.168.56.11
  Normal  SuccessfulMountVolume  52m   kubelet, 192.168.56.11  MountVolume.SetUp succeeded for volume "default-token-5htws"
  Normal  Pulling                52m   kubelet, 192.168.56.11  pulling image "nginx"
  Normal  Pulled                 51m   kubelet, 192.168.56.11  Successfully pulled image "nginx"
  Normal  Created                51m   kubelet, 192.168.56.11  Created container
  Normal  Started                51m   kubelet, 192.168.56.11  Started container
</code></pre>
<p>åœ¨labelSelectorå’Œ topologyKeyçš„åŒçº§ï¼Œè¿˜å¯ä»¥å®šä¹‰ namespaces åˆ—è¡¨ï¼Œè¡¨ç¤ºåŒ¹é…å“ªäº› namespace é‡Œé¢çš„ podï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šåŒ¹é…å®šä¹‰çš„ pod æ‰€åœ¨çš„ namespaceï¼›å¦‚æœå®šä¹‰äº†è¿™ä¸ªå­—æ®µï¼Œä½†æ˜¯å®ƒçš„å€¼ä¸ºç©ºï¼Œåˆ™åŒ¹é…æ‰€æœ‰çš„ namespacesã€‚</p>
<p>soï¼Œä»¥ä¸Šæˆ‘ä»¬åˆ›å»ºçš„å››ä¸ªä¾‹å­ç»“æœä¸ºä¸‹:</p>
<pre><code>[root@linux-node1 affinity_study]# kubectl get pods -o wide
NAME                          READY     STATUS    RESTARTS   AGE       IP           NODE
with-node-affinity            1/1       Running   2          10h       10.2.70.16   192.168.56.14
with-node-selector            1/1       Running   0          8m        10.2.70.15   192.168.56.14
with-nodename                 1/1       Running   1          11h       10.2.88.9    192.168.56.11
with-pod-affinity             1/1       Running   0          10h       10.2.88.10   192.168.56.11
</code></pre>
<h2 id="5-æ±¡ç‚¹ï¼ˆTaintsï¼‰ä¸å®¹å¿ï¼ˆtolerationsï¼‰"><a href="#5-æ±¡ç‚¹ï¼ˆTaintsï¼‰ä¸å®¹å¿ï¼ˆtolerationsï¼‰" class="headerlink" title="5. æ±¡ç‚¹ï¼ˆTaintsï¼‰ä¸å®¹å¿ï¼ˆtolerationsï¼‰"></a>5. æ±¡ç‚¹ï¼ˆTaintsï¼‰ä¸å®¹å¿ï¼ˆtolerationsï¼‰</h2><p>å¯¹äºnodeAffinityæ— è®ºæ˜¯ç¡¬ç­–ç•¥è¿˜æ˜¯è½¯ç­–ç•¥æ–¹å¼ï¼Œéƒ½æ˜¯è°ƒåº¦ POD åˆ°é¢„æœŸèŠ‚ç‚¹ä¸Šï¼Œè€ŒTaintsæ°å¥½ä¸ä¹‹ç›¸åï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸º Taints ï¼Œé™¤é POD ä¹Ÿè¢«æ ‡è¯†ä¸ºå¯ä»¥å®¹å¿æ±¡ç‚¹èŠ‚ç‚¹ï¼Œå¦åˆ™è¯¥ Taints èŠ‚ç‚¹ä¸ä¼šè¢«è°ƒåº¦podã€‚</p>
<p>æ¯”å¦‚ç”¨æˆ·å¸Œæœ›æŠŠ Master èŠ‚ç‚¹ä¿ç•™ç»™ Kubernetes ç³»ç»Ÿç»„ä»¶ä½¿ç”¨ï¼Œæˆ–è€…æŠŠä¸€ç»„å…·æœ‰ç‰¹æ®Šèµ„æºé¢„ç•™ç»™æŸäº› PODï¼Œåˆ™æ±¡ç‚¹å°±å¾ˆæœ‰ç”¨äº†ï¼ŒPOD ä¸ä¼šå†è¢«è°ƒåº¦åˆ° taint æ ‡è®°è¿‡çš„èŠ‚ç‚¹ã€‚taint æ ‡è®°èŠ‚ç‚¹ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<h6 id="5-1-è®¾ç½®æ±¡ç‚¹"><a href="#5-1-è®¾ç½®æ±¡ç‚¹" class="headerlink" title="5.1 è®¾ç½®æ±¡ç‚¹"></a>5.1 è®¾ç½®æ±¡ç‚¹</h6><pre><code> kubectl taint node [node] key=value[effect]   
      å…¶ä¸­[effect] å¯å–å€¼ï¼š [ NoSchedule | PreferNoSchedule | NoExecute ]
       NoSchedule ï¼šä¸€å®šä¸èƒ½è¢«è°ƒåº¦ã€‚POD ä¸ä¼šè¢«è°ƒåº¦åˆ°æ ‡è®°ä¸º taints èŠ‚ç‚¹ã€‚
       PreferNoScheduleï¼šå°½é‡ä¸è¦è°ƒåº¦ã€‚NoSchedule çš„è½¯ç­–ç•¥ç‰ˆæœ¬ã€‚
       NoExecuteï¼šä¸ä»…ä¸ä¼šè°ƒåº¦ï¼Œè¿˜ä¼šé©±é€Nodeä¸Šå·²æœ‰çš„Podã€‚
  ç¤ºä¾‹ï¼škubectl taint node 192.168.56.11 key1=value1:NoSchedule
</code></pre>
<h6 id="5-2-å»é™¤æ±¡ç‚¹"><a href="#5-2-å»é™¤æ±¡ç‚¹" class="headerlink" title="5.2 å»é™¤æ±¡ç‚¹"></a>5.2 å»é™¤æ±¡ç‚¹</h6><pre><code>#æ¯”å¦‚è®¾ç½®æ±¡ç‚¹ï¼š
    kubectl taint nodes 192.168.56.11 key1=value1:NoSchedule
    kubectl taint nodes 192.168.56.11 key2=value2:NoExecute
    kubectl taint nodes 192.168.56.11 key3=value3:PreferNoSchedule
 #å»é™¤æŒ‡å®škeyåŠå…¶effectï¼š
    kubectl taint nodes 192.168.56.11 key:[effect]-    #(è¿™é‡Œçš„keyä¸ç”¨æŒ‡å®švalue)
                
 #å»é™¤æŒ‡å®škeyæ‰€æœ‰çš„effect: 
     kubectl taint nodes 192.168.56.11 key-
 
 #ç¤ºä¾‹ï¼š
     kubectl taint node 192.168.56.11 key1:NoSchedule-
     kubectl taint node 192.168.56.11 key2:NoExecute-
     kubectl taint node 192.168.56.11 key3:PreferNoSchedule-
     kubectl taint node 192.168.56.11 key3- (å»é™¤æŒ‡å®škeyçš„æ‰€æœ‰effct)
</code></pre>
<h6 id="5-3-å®è·µ"><a href="#5-3-å®è·µ" class="headerlink" title="5.3 å®è·µ"></a>5.3 å®è·µ</h6><h6 id="5-3-1-ç»™èŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹"><a href="#5-3-1-ç»™èŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹" class="headerlink" title="# 5.3.1 ç»™èŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹"></a># 5.3.1 ç»™èŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹</h6><p>é¦–å…ˆæˆ‘çš„ç¯å¢ƒä¸­è¿˜æ²¡æœ‰è®¾ç½®æ±¡ç‚¹ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹ä¾‹å­(nginx-deployment.yaml):</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-pod
  labels:
    app: nginx-pod
spec:
  replicas: 10 # è¿™é‡Œä¸ºäº†å®è·µæ•ˆæœç‰¹æ„è®¾å®šäº†10ä¸ªå‰¯æœ¬
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80
        
# éƒ¨ç½²ç»“æœ:
[root@linux-node1 ~]# kubectl get pods -o wide | grep nginx
nginx-pod-7d9f9876cc-95fj2   1/1       Running   0          1m        10.2.70.26   192.168.56.14
nginx-pod-7d9f9876cc-jclvf   1/1       Running   0          1m        10.2.44.28   192.168.56.13
nginx-pod-7d9f9876cc-k2m6x   1/1       Running   0          1m        10.2.44.31   192.168.56.13
nginx-pod-7d9f9876cc-l74hf   1/1       Running   0          1m        10.2.88.15   192.168.56.11
nginx-pod-7d9f9876cc-n8g6c   1/1       Running   0          1m        10.2.44.29   192.168.56.13
nginx-pod-7d9f9876cc-p2cft   1/1       Running   0          1m        10.2.88.14   192.168.56.11
nginx-pod-7d9f9876cc-p7hvt   1/1       Running   0          1m        10.2.69.25   192.168.56.12
nginx-pod-7d9f9876cc-rjj97   1/1       Running   0          1m        10.2.70.27   192.168.56.14
nginx-pod-7d9f9876cc-t2wlw   1/1       Running   0          1m        10.2.69.26   192.168.56.12
nginx-pod-7d9f9876cc-whkx9   1/1       Running   0          1m        10.2.44.30   192.168.56.13
</code></pre>
<p>ä»¥ä¸Šä¾‹å­å¯ä»¥çœ‹å‡ºåœ¨æˆ‘çš„ç¯å¢ƒä¸­å·²ç»åˆ†é…åˆ°äº†æ¯ä¸ªèŠ‚ç‚¹åŒ…æ‹¬æˆ‘ä»¬æ¥ä¸‹æ¥å‡†å¤‡è®¾ç½®æ±¡ç‚¹çš„èŠ‚ç‚¹192.168.56.11ã€‚</p>
<p>ä¸‹é¢æˆ‘æŠŠmasterèŠ‚ç‚¹192.168.56.11 è®¾ç½®æ±¡ç‚¹(è¿™é‡Œæˆ‘ç”¨çš„effectæ˜¯NoSchedule)</p>
<pre><code>[root@linux-node1 affinity_study]# kubectl taint nodes 192.168.56.11 server_type=k8s_system:NoSchedule
node "192.168.56.11" tainted

# ç„¶åéƒ¨ç½²ä¸‹é¢è¿™ä¸ªè®¾ç½®ä¾‹å­:
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-pod-taints
  labels:
    app: nginx-pod-taints
spec:
  replicas: 10 # è¿™é‡Œä¸ºäº†å®è·µæ•ˆæœç‰¹æ„è®¾å®šäº†10ä¸ªå‰¯æœ¬
  selector:
    matchLabels:
      app: nginx-taints
  template:
    metadata:
      labels:
        app: nginx-taints
    spec:
      containers:
      - name: nginx-taints
        image: nginx:latest
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80
# éƒ¨ç½²ç»“æœ:
[root@linux-node1 ~]# kubectl get pods -o wide | grep nginx-pod-taints
nginx-pod-taints-57757d7677-5h6nj   1/1       Running   0          2m        10.2.69.31   192.168.56.12
nginx-pod-taints-57757d7677-dkd8h   1/1       Running   0          2m        10.2.70.34   192.168.56.14
nginx-pod-taints-57757d7677-f2vdn   1/1       Running   0          2m        10.2.44.38   192.168.56.13
nginx-pod-taints-57757d7677-fnx2n   1/1       Running   0          2m        10.2.44.36   192.168.56.13
nginx-pod-taints-57757d7677-gsc5g   1/1       Running   0          2m        10.2.70.32   192.168.56.14
nginx-pod-taints-57757d7677-kjl89   1/1       Running   0          2m        10.2.44.35   192.168.56.13
nginx-pod-taints-57757d7677-mqx27   1/1       Running   0          2m        10.2.70.33   192.168.56.14
nginx-pod-taints-57757d7677-skdd4   1/1       Running   0          2m        10.2.69.32   192.168.56.12
nginx-pod-taints-57757d7677-spwfh   1/1       Running   0          2m        10.2.69.30   192.168.56.12
nginx-pod-taints-57757d7677-tpcm8   1/1       Running   0          2m        10.2.44.37   192.168.56.13
</code></pre>
<p>ä»¥ä¸Šä¾‹å­å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å°†masterèŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹ä¹‹åè°ƒåº¦å™¨å¹¶æ²¡æœ‰æŠŠpodè°ƒåº¦åˆ°masterèŠ‚ç‚¹ä¸Šã€‚<br>è¿™é‡Œæˆ‘é€‰æ‹©çš„effectæ˜¯NoScheduleï¼Œä¹Ÿå°±æ˜¯ä¸€å®šä¸è¦è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ã€‚</p>
<h6 id="5-3-2-ç»™éƒ¨ç½²é…ç½®è®¾ç½®å®¹å¿æ€§"><a href="#5-3-2-ç»™éƒ¨ç½²é…ç½®è®¾ç½®å®¹å¿æ€§" class="headerlink" title="# 5.3.2 ç»™éƒ¨ç½²é…ç½®è®¾ç½®å®¹å¿æ€§"></a># 5.3.2 ç»™éƒ¨ç½²é…ç½®è®¾ç½®å®¹å¿æ€§</h6><p>é¦–å…ˆ æˆ‘ä»¬ä¸Šé¢è®¾ç½®äº†æ±¡ç‚¹<br>å³:</p>
<pre><code>  taints:
  - effect: NoSchedule
    key: server_type
    value: k8s_system
</code></pre>
<p>ç„¶åæˆ‘ä»¬éƒ¨ç½²ä»¥ä¸‹ä¾‹å­(test-tolertations.yaml)</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-pod-taints-tolerations
  labels:
    app: nginx-pod-taints-tolerations
spec:
  replicas: 10 # è¿™é‡Œä¸ºäº†å®è·µæ•ˆæœç‰¹æ„è®¾å®šäº†10ä¸ªå‰¯æœ¬
  selector:
    matchLabels:
      app: nginx-taints-tolerations
  template:
    metadata:
      labels:
        app: nginx-taints-tolerations
    spec:
      # è®¾ç½®å®¹å¿æ€§
      tolerations:
      - key: "server_type"
        operator: "Equal"
        value: "k8s_system"
        effect: "NoSchedule"
      containers:
      - name: nginx-taints-tolerations
        image: nginx:latest
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80

# éƒ¨ç½²ç»“æœ:
[root@linux-node1 affinity_study]# kubectl get pods -o wide  | grep nginx-pod-taints-tolerations
nginx-pod-taints-tolerations-5b4988bd4-2pk46   1/1       Running   0          29m       10.2.69.33   192.168.56.12
nginx-pod-taints-tolerations-5b4988bd4-854xx   1/1       Running   0          29m       10.2.70.35   192.168.56.14
nginx-pod-taints-tolerations-5b4988bd4-88xrt   1/1       Running   0          29m       10.2.69.34   192.168.56.12
nginx-pod-taints-tolerations-5b4988bd4-8czpg   1/1       Running   0          29m       10.2.88.17   192.168.56.11
nginx-pod-taints-tolerations-5b4988bd4-czdss   1/1       Running   0          21m       10.2.44.41   192.168.56.13
nginx-pod-taints-tolerations-5b4988bd4-dj6mw   1/1       Running   0          29m       10.2.88.16   192.168.56.11
nginx-pod-taints-tolerations-5b4988bd4-g4ltd   1/1       Running   0          29m       10.2.44.39   192.168.56.13
nginx-pod-taints-tolerations-5b4988bd4-npthj   1/1       Running   0          29m       10.2.44.40   192.168.56.13
nginx-pod-taints-tolerations-5b4988bd4-ptlqg   1/1       Running   0          29m       10.2.88.18   192.168.56.11
nginx-pod-taints-tolerations-5b4988bd4-t9gs6   1/1       Running   0          29m       10.2.69.35   192.168.56.12
</code></pre>
<p>ä»¥ä¸Šå®è·µæˆ‘ä»¬è§£è¯»ä¸€ä¸‹:<br>1. åœ¨èŠ‚ç‚¹master 192.168.56.11ä¸Šé¢è®¾ç½®äº†æ±¡ç‚¹ï¼›ä½†æœŸæœ›è¯¥èŠ‚ç‚¹èƒ½å®¹å¿è°ƒåº¦;<br>2. äºæ˜¯é€šè¿‡è®¾ç½®tolerationsæ¥å®ç°ï¼Œå…¶ä¸­Podè¦å®¹å¿çš„æœ‰æ±¡ç‚¹çš„Nodeçš„keyæ˜¯server_type Equal k8s_system,æ•ˆæœæ˜¯NoSchedule.<br>3. é€šè¿‡è®¾ç½®å®¹å¿æœºåˆ¶ç»“æœä¸é¢„æœŸç›¸ç¬¦ã€‚</p>
<p>å¯¹äºtolerationså±æ€§çš„å†™æ³•ï¼š</p>
<pre><code>å…¶ä¸­çš„keyã€valueã€effect ä¸Nodeçš„Taintè®¾ç½®éœ€ä¿æŒä¸€è‡´ï¼Œ è¿˜æœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼š
     1ã€å¦‚æœoperatorçš„å€¼æ˜¯Existsï¼Œåˆ™valueå±æ€§å¯çœç•¥ã€‚
     2ã€å¦‚æœoperatorçš„å€¼æ˜¯Equalï¼Œåˆ™è¡¨ç¤ºå…¶keyä¸valueä¹‹é—´çš„å…³ç³»æ˜¯equal(ç­‰äº)ã€‚
     3ã€å¦‚æœä¸æŒ‡å®šoperatorå±æ€§ï¼Œåˆ™é»˜è®¤å€¼ä¸ºEqualã€‚
å¦å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªç‰¹æ®Šå€¼ï¼š
     1ã€ç©ºçš„key å¦‚æœå†é…åˆExists å°±èƒ½åŒ¹é…æ‰€æœ‰çš„keyä¸value ï¼Œä¹Ÿæ˜¯æ˜¯èƒ½å®¹å¿æ‰€æœ‰nodeçš„æ‰€æœ‰Taintsã€‚
     2ã€ç©ºçš„effect åŒ¹é…æ‰€æœ‰çš„effectã€‚
</code></pre>
<h6 id="5-3-3-å…¶ä»–"><a href="#5-3-3-å…¶ä»–" class="headerlink" title="# 5.3.3 å…¶ä»–"></a># 5.3.3 å…¶ä»–</h6><p>ä¸€ä¸ªnodeä¸Šå¯ä»¥æœ‰å¤šä¸ªæ±¡ç‚¹ï¼š</p>
<pre><code>[root@linux-node1 affinity_study]# kubectl describe node/192.168.56.11
........
........
Taints:             server_type=k8s_system:NoSchedule
                    test=wahaha:PreferNoSchedule
........
........
</code></pre>
<p>å¦‚æœæŒ‰ç…§æˆ‘ä¸Šé¢çš„ä¾‹å­æ¥çš„è¯ç»“æœå°†ä¸ä¼šæœ‰ä»»ä½•podè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ï¼Œå› ä¸ºä¸Šè¿°æˆ‘åªå®¹å¿äº†ä¸€ä¸ªæ±¡ç‚¹ï¼›æ‰€ä»¥å¯ä»¥æ–°åŠ ä¸€ä¸ªæ±¡ç‚¹å®¹å¿:</p>
<pre><code>[root@linux-node1 affinity_study]# more test-tolertations.yaml
........
........      
    tolerations:
      - key: "server_type"
        operator: "Equal"
        value: "k8s_system"
        effect: "NoSchedule"
      - key: "test"
        operator: "Equal"
        value: "wahaha"
        effect: "PreferNoSchedule"
........
........
</code></pre>
<p>é‡æ–°éƒ¨ç½²åç»“æœä¹Ÿå¯ä»¥é¢„è§ åªè¦ä¸¤ä¸ªå®¹å¿æ»¡è¶³å°±å¯ä»¥è°ƒåº¦è¿‡å»å•¦~</p>
<p>è®¾ç½®å®¹å¿çš„æ•ˆæœï¼š</p>
<ul>
<li>å¦‚æœåœ¨è®¾ç½®nodeçš„Taints(æ±¡ç‚¹)ä¹‹å‰ï¼Œå°±å·²ç»è¿è¡Œäº†ä¸€äº›Podï¼Œé‚£ä¹ˆè¿™äº›Podæ˜¯å¦è¿˜èƒ½ç»§ç»­åœ¨æ­¤Nodeä¸Šè¿è¡Œï¼Ÿ è¿™å°±è¦çœ‹è®¾ç½®Taintsæ±¡ç‚¹æ—¶çš„effect(æ•ˆæœ)äº†ã€‚</li>
<li>å¦‚æœeffectçš„å€¼æ˜¯NoScheduleæˆ–PreferNoScheduleï¼Œé‚£ä¹ˆå·²è¿è¡Œçš„Podä»ç„¶å¯ä»¥è¿è¡Œï¼Œåªæ˜¯æ–°Pod(å¦‚æœæ²¡æœ‰å®¹å¿)ä¸ä¼šå†å¾€ä¸Šè°ƒåº¦ã€‚</li>
<li>å¦‚æœ pod ä¸èƒ½å¿å—effect å€¼ä¸º NoExecute çš„ taintï¼Œé‚£ä¹ˆ pod å°†é©¬ä¸Šè¢«é©±é€</li>
<li>å¦‚æœ pod èƒ½å¤Ÿå¿å—effect å€¼ä¸º NoExecute çš„ taintï¼Œä½†æ˜¯åœ¨ toleration å®šä¹‰ä¸­æ²¡æœ‰æŒ‡å®š tolerationSecondsï¼Œåˆ™ pod è¿˜ä¼šä¸€ç›´åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚</li>
<li>å¦‚æœ pod èƒ½å¤Ÿå¿å—effect å€¼ä¸º NoExecute çš„ taintï¼Œè€Œä¸”æŒ‡å®šäº† tolerationSecondsï¼Œåˆ™ pod è¿˜èƒ½åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šç»§ç»­è¿è¡Œè¿™ä¸ªæŒ‡å®šçš„æ—¶é—´é•¿åº¦ã€‚ è™½ç„¶æ˜¯ç«‹åˆ»è¢«é©±é€ï¼Œä½†æ˜¯K8Sä¸ºäº†å½°æ˜¾äººæ€§åŒ–ï¼Œåˆç»™å…·æœ‰NoExecuteæ•ˆæœçš„æ±¡ç‚¹ï¼Œ åœ¨å®¹å¿å±æ€§ä¸­æœ‰ä¸€ä¸ªå¯é€‰çš„tolerationSecondså­—æ®µï¼Œç”¨æ¥è®¾ç½®è¿™äº›Podè¿˜å¯ä»¥åœ¨è¿™ä¸ªNodeä¹‹ä¸Šè¿è¡Œå¤šä¹…ï¼Œç»™å®ƒä»¬ä¸€ç‚¹å®½é™çš„æ—¶é—´ï¼Œåˆ°æ—¶é—´æ‰é©±é€ã€‚</li>
</ul>
<p>ä¸åŒçš„éƒ¨ç½²å¯åŠ¨æ–¹å¼ï¼š</p>
<ul>
<li><p>å¦‚æœæ˜¯ä»¥Podæ¥å¯åŠ¨çš„ï¼Œé‚£ä¹ˆPodè¢«é©±é€åï¼Œ å°†ä¸ä¼šå†è¢«è¿è¡Œï¼Œå°±ç­‰äºæŠŠå®ƒåˆ é™¤äº†ã€‚</p>
</li>
<li><p>å¦‚æœæ˜¯deployment/rcï¼Œé‚£ä¹ˆåˆ é™¤çš„podä¼šå†å…¶å®ƒèŠ‚ç‚¹è¿è¡Œã€‚</p>
</li>
<li><p>å¦‚æœæ˜¯DaemonSetåœ¨æ­¤Nodeä¸Šå¯åŠ¨çš„Podï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šå†è¢«è¿è¡Œï¼Œç›´åˆ°Nodeä¸Šçš„NoExecuteæ±¡è¢«å»é™¤æˆ–è€…Podå®¹å¿ã€‚</p>
<p>#è®¾ç½®Podçš„å®½é™æ—¶é—´<br>spec:<br>  tolerations: #è®¾ç½®å®¹å¿æ€§</p>
<ul>
<li>key: â€œtestâ€<br>operator: â€œEqualâ€ #å¦‚æœæ“ä½œç¬¦ä¸ºExistsï¼Œé‚£ä¹ˆvalueå±æ€§å¯çœç•¥<br>value: â€œ16â€<br>effect: â€œwahahaâ€<br>tolerationSeconds: 180 <h1 id="å¦‚æœè¿è¡Œæ­¤Podçš„Nodeï¼Œè¢«è®¾ç½®äº†å…·æœ‰NoExecuteæ•ˆæœçš„Taint-æ±¡ç‚¹-ï¼Œè¿™ä¸ªPodå°†åœ¨å­˜æ´»180såæ‰è¢«é©±é€ã€‚"><a href="#å¦‚æœè¿è¡Œæ­¤Podçš„Nodeï¼Œè¢«è®¾ç½®äº†å…·æœ‰NoExecuteæ•ˆæœçš„Taint-æ±¡ç‚¹-ï¼Œè¿™ä¸ªPodå°†åœ¨å­˜æ´»180såæ‰è¢«é©±é€ã€‚" class="headerlink" title="å¦‚æœè¿è¡Œæ­¤Podçš„Nodeï¼Œè¢«è®¾ç½®äº†å…·æœ‰NoExecuteæ•ˆæœçš„Taint(æ±¡ç‚¹)ï¼Œè¿™ä¸ªPodå°†åœ¨å­˜æ´»180såæ‰è¢«é©±é€ã€‚"></a>å¦‚æœè¿è¡Œæ­¤Podçš„Nodeï¼Œè¢«è®¾ç½®äº†å…·æœ‰NoExecuteæ•ˆæœçš„Taint(æ±¡ç‚¹)ï¼Œè¿™ä¸ªPodå°†åœ¨å­˜æ´»180såæ‰è¢«é©±é€ã€‚</h1><h1 id="å¦‚æœæ²¡æœ‰è®¾ç½®tolerationSecondså­—æ®µï¼Œå°†æ°¸ä¹…è¿è¡Œã€‚"><a href="#å¦‚æœæ²¡æœ‰è®¾ç½®tolerationSecondså­—æ®µï¼Œå°†æ°¸ä¹…è¿è¡Œã€‚" class="headerlink" title="å¦‚æœæ²¡æœ‰è®¾ç½®tolerationSecondså­—æ®µï¼Œå°†æ°¸ä¹…è¿è¡Œã€‚"></a>å¦‚æœæ²¡æœ‰è®¾ç½®tolerationSecondså­—æ®µï¼Œå°†æ°¸ä¹…è¿è¡Œã€‚</h1></li>
</ul>
</li>
</ul>
<p>é€šè¿‡å¯¹Taintså’ŒTolerationsçš„äº†è§£ï¼Œå¯ä»¥çŸ¥é“ï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥è®©æŸäº›ç‰¹å®šåº”ç”¨ï¼Œç‹¬å ä¸€ä¸ªNodeï¼Œç»™ç‰¹å®šçš„Nodeè®¾ç½®ä¸€ä¸ªTaintï¼Œåªè®©æŸäº›ç‰¹å®šçš„åº”ç”¨æ¥å®¹å¿è¿™äº›æ±¡ç‚¹ï¼Œå®¹å¿åå°±æœ‰å¯èƒ½ä¼šè¢«è°ƒåº¦åˆ°æ­¤ç‰¹å®šNodeï¼Œä½†æ˜¯ä¹Ÿä¸ä¸€å®šä¼šè°ƒåº¦ç»™æ­¤ç‰¹å®šNodeï¼Œè®¾ç½®å®¹å¿å¹¶ä¸é˜»æ­¢è°ƒåº¦å™¨è°ƒåº¦ç»™å…¶å®ƒNodeï¼Œé‚£ä¹ˆå¦‚ä½•è®©ç‰¹å®šåº”ç”¨çš„Nodeï¼Œåªèƒ½è¢«è°ƒåº¦åˆ°æ­¤ç‰¹å®šçš„Nodeå‘¢ï¼Œè¿™å°±è¦ç»“åˆNodeAffinityèŠ‚ç‚¹äº²å’Œæ€§ï¼Œç»™Nodeæ‰“ä¸ªæ ‡ç­¾ï¼Œç„¶ååœ¨Podå±æ€§é‡Œè®¾ç½®NodeAffinityåˆ°Nodeã€‚å¦‚æ­¤å°±èƒ½è¾¾åˆ°è¦æ±‚äº†ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.sctux.cc">NoardGuo-Ops</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.sctux.cc/2018/12/04/li-jiekubernetes-de-qin-he-xing-diao-du/">https://blog.sctux.cc/2018/12/04/li-jiekubernetes-de-qin-he-xing-diao-du/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://blog.sctux.cc" target="_blank">OpsThoughts</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2018/12/07/k8s-ji-qun-zhongpause-rong-qi-shi-gan-ma-de/" title="K8sé›†ç¾¤ä¸­pauseå®¹å™¨æ˜¯å¹²å˜›çš„~"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">K8sé›†ç¾¤ä¸­pauseå®¹å™¨æ˜¯å¹²å˜›çš„~</div></div><div class="info-2"><div class="info-item-1">å½“æˆ‘ä»¬åœ¨æ£€æŸ¥k8sé›†ç¾¤çŠ¶æ€çš„æ—¶å€™ä¼šå‘ç°æœ‰å¾ˆå¤š pause å®¹å™¨è¿è¡ŒäºæœåŠ¡å™¨ä¸Šé¢ï¼Œç„¶åæ¯æ¬¡å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œéƒ½ä¼šä¼´éšä¸€ä¸ªpauseå®¹å™¨çš„å¯åŠ¨ã€‚é‚£å®ƒç©¶ç«Ÿæ˜¯å¹²å•¥å­çš„ï¼Ÿ Pauseå®¹å™¨ï¼Œåˆå«Infraå®¹å™¨ï¼Œä¸‹é¢é€šè¿‡å®éªŒæ¥ç†è§£å®ƒã€‚ æˆ‘ä»¬çŸ¥é“åœ¨æ­å»ºk8sé›†ç¾¤çš„æ—¶å€™ï¼Œkubeletçš„é…ç½®ä¸­æœ‰è¿™æ ·ä¸€ä¸ªå‚æ•°ï¼š [root@linux-node1 cfg]# more /usr/lib/systemd/system/kubelet.service Â·Â·Â·Â·Â·Â· Â·Â·Â·Â·Â·Â·   --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1 \ Â·Â·Â·Â·Â·Â· Â·Â·Â·Â·Â·Â·  æˆ‘è¿™é‡Œæ˜¯ç›´æ¥å°†è¿™äº›é…ç½®å‚æ•°é€šè¿‡å¯åŠ¨è„šæœ¬æ¥è¡¥å……è¿›å»çš„ã€‚Pauseå®¹å™¨ï¼Œæ˜¯å¯ä»¥è‡ªå·±æ¥å®šä¹‰ï¼Œå®˜æ–¹ä½¿ç”¨çš„gcr.io/google_containers/pause-amd64:3.0å®¹å™¨çš„ä»£ç è§Githubï¼Œä½¿ç”¨Cè¯­è¨€ç¼–å†™ã€‚ Pauseå®¹å™¨çš„ä½œç”¨æˆ‘ä»¬æ£€æŸ¥nodèŠ‚ç‚¹çš„æ—¶å€™ä¼šå‘ç°æ¯ä¸ªnodeä¸Šéƒ½è¿è¡Œäº†å¾ˆå¤šçš„pause...</div></div></div></a><a class="pagination-related" href="/2018/12/03/kubernetes-diao-du-zhinodeselector-trashed/" title="kubernetesè°ƒåº¦ä¹‹NodeSelector"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">kubernetesè°ƒåº¦ä¹‹NodeSelector</div></div><div class="info-2"><div class="info-item-1">1 NodeNamePod.spec.nodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Šï¼Œè¿™é‡Œè¯´æ˜¯â€œè°ƒåº¦â€ï¼Œä½†å…¶å®æŒ‡å®šäº†nodeNameçš„Podä¼šç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å†™å…¥PodListåˆ—è¡¨ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶åŒ¹é…ã€‚ä¾‹å­ï¼š apiVersion: apps/v1 kind: Deployment metadata:   name: nginx-test   labels:     app: nginx spec:   replicas: 3   selector:     matchLabels:       app: nginx   template:     metadata:       labels:         app: nginx     spec:       nodeName: 192.168.56.13 # æŒ‡å®špodè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹       containers:       - name: nginx         image: nginx:latest         imagePullPolicy: IfNotPres...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2018/12/09/k8s-yaml-bian-xie-xiao-ji-qiao/" title="K8s Yamlç¼–å†™å°æŠ€å·§"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-12-09</div><div class="info-item-2">K8s Yamlç¼–å†™å°æŠ€å·§</div></div><div class="info-2"><div class="info-item-1">  å­¦ä¹ ä½¿ç”¨k8sçš„ç«¥é‹éƒ½çŸ¥é“æˆ‘ä»¬åœ¨éƒ¨ç½²podçš„æ—¶å€™æœ‰æ—¶å€™éœ€è¦æ‰‹åŠ¨å»ç¼–å†™ä¸€äº›yamlæ–‡ä»¶ï¼›æ¯”å¦‚æˆ‘éœ€è¦ç¼–å†™deployment,é‚£é™¤äº†åœ¨å…¶ä»–åœ°æ–¹ç²˜è´´æ‹·è´å¤–æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ 1.ç”¨runå‘½ä»¤ç”Ÿæˆï¼Œç„¶åä½œä¸ºæ¨¡æ¿è¿›è¡Œç¼–è¾‘ã€‚12345678910kubectl run --image=nginx my-deploy -o yaml --dry-run &gt; my-deploy.yaml ```   ### 2.ç”¨getå‘½ä»¤å¯¼å‡ºï¼Œç„¶åä½œä¸ºæ¨¡æ¿è¿›è¡Œç¼–è¾‘ã€‚```  # æ³¨æ„: --export æ˜¯ä¸ºäº†å»é™¤å½“å‰æ­£åœ¨è¿è¡Œçš„è¿™ä¸ªdeploymentç”Ÿæˆçš„ä¸€äº›çŠ¶æ€ï¼Œæˆ‘ä»¬ç”¨ä¸åˆ°å°±è¿‡æ»¤æ‰kubectl get deployment/nginx -o=yaml --export  &gt; new.yaml```      ### 3.Podäº²å’Œæ€§ä¸‹é¢å­—æ®µçš„æ‹¼å†™å¿˜è®°äº† kubectl explain pod.spec.affinity.podAffinity  ç¤ºä¾‹: ---  æˆ‘æƒ³ç”Ÿæˆä¸€ä¸ªæœ‰ä¸‰ä¸ªå‰¯æœ¬çš„redis podçš„yamlï¼Œç„¶åæˆ‘æƒ³æŠŠè¿™ä¸‰ä¸ªpod é€šè¿‡nodeäº²å’Œæ€§è°ƒåº¦åˆ°åŒä¸€ä¸ªnode...</div></div></div></a><a class="pagination-related" href="/2018/12/07/k8s-ji-qun-zhongpause-rong-qi-shi-gan-ma-de/" title="K8sé›†ç¾¤ä¸­pauseå®¹å™¨æ˜¯å¹²å˜›çš„~"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-12-07</div><div class="info-item-2">K8sé›†ç¾¤ä¸­pauseå®¹å™¨æ˜¯å¹²å˜›çš„~</div></div><div class="info-2"><div class="info-item-1">å½“æˆ‘ä»¬åœ¨æ£€æŸ¥k8sé›†ç¾¤çŠ¶æ€çš„æ—¶å€™ä¼šå‘ç°æœ‰å¾ˆå¤š pause å®¹å™¨è¿è¡ŒäºæœåŠ¡å™¨ä¸Šé¢ï¼Œç„¶åæ¯æ¬¡å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œéƒ½ä¼šä¼´éšä¸€ä¸ªpauseå®¹å™¨çš„å¯åŠ¨ã€‚é‚£å®ƒç©¶ç«Ÿæ˜¯å¹²å•¥å­çš„ï¼Ÿ Pauseå®¹å™¨ï¼Œåˆå«Infraå®¹å™¨ï¼Œä¸‹é¢é€šè¿‡å®éªŒæ¥ç†è§£å®ƒã€‚ æˆ‘ä»¬çŸ¥é“åœ¨æ­å»ºk8sé›†ç¾¤çš„æ—¶å€™ï¼Œkubeletçš„é…ç½®ä¸­æœ‰è¿™æ ·ä¸€ä¸ªå‚æ•°ï¼š [root@linux-node1 cfg]# more /usr/lib/systemd/system/kubelet.service Â·Â·Â·Â·Â·Â· Â·Â·Â·Â·Â·Â·   --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1 \ Â·Â·Â·Â·Â·Â· Â·Â·Â·Â·Â·Â·  æˆ‘è¿™é‡Œæ˜¯ç›´æ¥å°†è¿™äº›é…ç½®å‚æ•°é€šè¿‡å¯åŠ¨è„šæœ¬æ¥è¡¥å……è¿›å»çš„ã€‚Pauseå®¹å™¨ï¼Œæ˜¯å¯ä»¥è‡ªå·±æ¥å®šä¹‰ï¼Œå®˜æ–¹ä½¿ç”¨çš„gcr.io/google_containers/pause-amd64:3.0å®¹å™¨çš„ä»£ç è§Githubï¼Œä½¿ç”¨Cè¯­è¨€ç¼–å†™ã€‚ Pauseå®¹å™¨çš„ä½œç”¨æˆ‘ä»¬æ£€æŸ¥nodèŠ‚ç‚¹çš„æ—¶å€™ä¼šå‘ç°æ¯ä¸ªnodeä¸Šéƒ½è¿è¡Œäº†å¾ˆå¤šçš„pause...</div></div></div></a><a class="pagination-related" href="/2018/07/15/kubernetes-session-bao-chi-deng-she-zhi/" title="Kubernetes Sessionäº²å’Œæ€§è®¾ç½®"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-15</div><div class="info-item-2">Kubernetes Sessionäº²å’Œæ€§è®¾ç½®</div></div><div class="info-2"><div class="info-item-1">å½“æˆ‘ä»¬åœ¨éƒ¨ç½²äº†å¤šä¸ªpodï¼Œä»¥åŠä¸€ä¸ªServiceåï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å†…éƒ¨é€šè¿‡ServiceIPè®¿é—®podæä¾›çš„æœåŠ¡äº†ï¼›ï¿¼ï¿¼ å½“ä¸è®¾ç½®sessionä¿æŒæ—¶ï¼Œserviceå‘åå°podè½¬å‘è§„åˆ™æ˜¯è½®è¯¢:ï¿¼ï¿¼ï¿¼ä»¥ä¸Šæˆ‘é€šè¿‡ç‚¹å‡»é¡µé¢è¯·æ±‚ï¼Œå¯ä»¥å°±çœ‹å‡ºserviceå°†æˆ‘çš„è¯·æ±‚åˆ†å‘åˆ°äº†åé¢çš„ä¸‰ä¸ªpod; k8sä¼šæ ¹æ®è®¿é—®çš„ipæ¥æŠŠè¯·æ±‚è½¬å‘ç»™ä»–ä»¥å‰è®¿é—®è¿‡çš„podï¼Œè¿™æ ·sessionå°±ä¿æŒä½äº†ã€‚æŸ¥çœ‹åˆ›å»ºserviceæ—¶çš„yamlæ–‡ä»¶å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®çš„è¯ è¯¥é¡¹æ˜¯ä¸ºNoneçš„ï¿¼ </div></div></div></a><a class="pagination-related" href="/2018/07/14/ru-he-jiangpod-zhong-decontainer-shi-qu-geng-gai-w/" title="å¦‚ä½•å°†podä¸­çš„containeræ—¶åŒºæ›´æ”¹ä¸ºåŒä¸€æ—¶åŒºçš„åŸå¸‚æˆ–UTCæ—¶åŒºåç§»"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-14</div><div class="info-item-2">å¦‚ä½•å°†podä¸­çš„containeræ—¶åŒºæ›´æ”¹ä¸ºåŒä¸€æ—¶åŒºçš„åŸå¸‚æˆ–UTCæ—¶åŒºåç§»</div></div><div class="info-2"><div class="info-item-1">é—®é¢˜:åœ¨åˆ›å»ºpod containeråå‘ç°é‡Œé¢çš„æ—¶åŒºæ˜¯UTC,å¯¹äºå›½å†…ä¹ æƒ¯è¿˜æ˜¯CSTæ—¶åŒºæ¯”è¾ƒæ˜“è¯»ï¼›é‚£å¦‚ä½•è§£å†³è¿™ç§é—®é¢˜å˜›ï¼Ÿæš‚æ—¶æƒ³åˆ°çš„ä¸¤ç§åŠæ³•: [root@linux-node1 ~]# kubectl exec flask-app-nginx-66b56f556c-zb84s date -n flask-app-extions-stage Mon Jul 14 07:32:52 UTC 2018 [root@linux-node1 ~]# date Mon Jul 14 15:32:52 CST 2018   ç›´æ¥ä¿®æ”¹é•œåƒçš„æ—¶é—´è®¾ç½®ï¼Œå¥½å¤„æ˜¯åº”ç”¨éƒ¨ç½²æ—¶æ— éœ€ç‰¹æ®Šè®¾ç½®ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨ä»æ–°æ„å»ºDockeré•œåƒ éƒ¨ç½²åº”ç”¨æ—¶ï¼Œå•ç‹¬è¯»å–ä¸»æœºçš„â€/etc/localtimeâ€,æ— éœ€ä¿®æ”¹é•œåƒï¼Œä½†æ˜¯æ¯ä¸ªåº”ç”¨éƒ½è¦å•ç‹¬è®¾ç½®ã€‚  è§£å†³:ä¸ºäº†å¿«é€Ÿï¼Œç®€å•çš„è§£å†³æ­¤é—®é¢˜ï¼Œå…ˆä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼›yamlæ–‡ä»¶ä¸­æ˜ å°„ä¸»æœºçš„â€/etc/localtimeâ€æ–‡ä»¶, æ·»åŠ yamlé…ç½®: ...... ......     spec:       containers:       - name: nginx         im...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">NoardGuo-Ops</div><div class="author-info-description">Happiness is not something ready-made. It comes from your own actionsğŸ’ªğŸ».</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">93</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">30</div></a></div><a id="card-info-btn" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-NodeName"><span class="toc-number">1.</span> <span class="toc-text">1. NodeName</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-1-%E4%BE%8B%E5%A6%82-test-nodename-yaml"><span class="toc-number">1.0.0.0.1.</span> <span class="toc-text">1.1 ä¾‹å¦‚(test-nodename.yaml)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-2-%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E4%BA%8B%E4%BB%B6%E3%80%81%E4%B8%8E%E9%A2%84%E6%9C%9F%E7%9B%B8%E7%AC%A6"><span class="toc-number">1.0.0.0.2.</span> <span class="toc-text">1.2 æŸ¥çœ‹åˆ›å»ºäº‹ä»¶ã€ä¸é¢„æœŸç›¸ç¬¦:</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-NodeSelector"><span class="toc-number">2.</span> <span class="toc-text">2. NodeSelector</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-1-Node%E6%B7%BB%E5%8A%A0label%E6%A0%87%E8%AE%B0-%E6%A0%87%E8%AE%B0%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">2.0.0.0.1.</span> <span class="toc-text">2.1 Nodeæ·»åŠ labelæ ‡è®°,æ ‡è®°è§„åˆ™ï¼š</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-2-%E7%A1%AE%E8%AE%A4%E6%A0%87%E8%AE%B0"><span class="toc-number">2.0.0.0.2.</span> <span class="toc-text">2.2 ç¡®è®¤æ ‡è®°</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-%E4%BE%8B%E5%A6%82-test-nodeselector-yaml"><span class="toc-number">2.0.0.0.3.</span> <span class="toc-text">2.3 ä¾‹å¦‚(test-nodeselector.yaml)</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">2.4 æŸ¥çœ‹åˆ›å»ºäº‹ä»¶:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-NodeAffinity"><span class="toc-number">3.</span> <span class="toc-text">3. NodeAffinity</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#3-1-%E4%BE%8B%E5%A6%82-test-node-affinity-yaml"><span class="toc-number">3.0.0.0.1.</span> <span class="toc-text">3.1 ä¾‹å¦‚(test-node-affinity.yaml)</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-PodAffinity"><span class="toc-number">4.</span> <span class="toc-text">4. PodAffinity</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#4-1-%E4%BE%8B%E5%A6%82-test-pod-affinity-yaml"><span class="toc-number">4.0.0.0.1.</span> <span class="toc-text">4.1 ä¾‹å¦‚(test-pod-affinity.yaml)</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%B1%A1%E7%82%B9%EF%BC%88Taints%EF%BC%89%E4%B8%8E%E5%AE%B9%E5%BF%8D%EF%BC%88tolerations%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">5. æ±¡ç‚¹ï¼ˆTaintsï¼‰ä¸å®¹å¿ï¼ˆtolerationsï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#5-1-%E8%AE%BE%E7%BD%AE%E6%B1%A1%E7%82%B9"><span class="toc-number">5.0.0.0.1.</span> <span class="toc-text">5.1 è®¾ç½®æ±¡ç‚¹</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-2-%E5%8E%BB%E9%99%A4%E6%B1%A1%E7%82%B9"><span class="toc-number">5.0.0.0.2.</span> <span class="toc-text">5.2 å»é™¤æ±¡ç‚¹</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-3-%E5%AE%9E%E8%B7%B5"><span class="toc-number">5.0.0.0.3.</span> <span class="toc-text">5.3 å®è·µ</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-3-1-%E7%BB%99%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE%E6%B1%A1%E7%82%B9"><span class="toc-number">5.0.0.0.4.</span> <span class="toc-text"># 5.3.1 ç»™èŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-3-2-%E7%BB%99%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%E8%AE%BE%E7%BD%AE%E5%AE%B9%E5%BF%8D%E6%80%A7"><span class="toc-number">5.0.0.0.5.</span> <span class="toc-text"># 5.3.2 ç»™éƒ¨ç½²é…ç½®è®¾ç½®å®¹å¿æ€§</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-3-3-%E5%85%B6%E4%BB%96"><span class="toc-number">5.0.0.0.6.</span> <span class="toc-text"># 5.3.3 å…¶ä»–</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E8%BF%90%E8%A1%8C%E6%AD%A4Pod%E7%9A%84Node%EF%BC%8C%E8%A2%AB%E8%AE%BE%E7%BD%AE%E4%BA%86%E5%85%B7%E6%9C%89NoExecute%E6%95%88%E6%9E%9C%E7%9A%84Taint-%E6%B1%A1%E7%82%B9-%EF%BC%8C%E8%BF%99%E4%B8%AAPod%E5%B0%86%E5%9C%A8%E5%AD%98%E6%B4%BB180s%E5%90%8E%E6%89%8D%E8%A2%AB%E9%A9%B1%E9%80%90%E3%80%82"><span class="toc-number"></span> <span class="toc-text">å¦‚æœè¿è¡Œæ­¤Podçš„Nodeï¼Œè¢«è®¾ç½®äº†å…·æœ‰NoExecuteæ•ˆæœçš„Taint(æ±¡ç‚¹)ï¼Œè¿™ä¸ªPodå°†åœ¨å­˜æ´»180såæ‰è¢«é©±é€ã€‚</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AEtolerationSeconds%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%B0%86%E6%B0%B8%E4%B9%85%E8%BF%90%E8%A1%8C%E3%80%82"><span class="toc-number"></span> <span class="toc-text">å¦‚æœæ²¡æœ‰è®¾ç½®tolerationSecondså­—æ®µï¼Œå°†æ°¸ä¹…è¿è¡Œã€‚</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/04/%E6%B1%82%E8%81%8C%E5%B8%96/" title="æ±‚èŒ-ç³»ç»Ÿè¿ç»´/SREæ–¹å‘">æ±‚èŒ-ç³»ç»Ÿè¿ç»´/SREæ–¹å‘</a><time datetime="2025-09-03T16:01:01.000Z" title="å‘è¡¨äº 2025-09-04 00:01:01">2025-09-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/23/Docker%E6%9E%84%E5%BB%BA%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%B9%B3%E5%8F%B0EFK-TLS/" title="Dockeræ„å»ºæ—¥å¿—æ”¶é›†å¹³å°EFK(TLS)">Dockeræ„å»ºæ—¥å¿—æ”¶é›†å¹³å°EFK(TLS)</a><time datetime="2024-07-23T01:56:27.000Z" title="å‘è¡¨äº 2024-07-23 09:56:27">2024-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/16/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8ElastAlert2%E5%AF%B9ES%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97%E5%88%9B%E5%BB%BA%E5%91%8A%E8%AD%A6/" title="å¦‚ä½•åˆ©ç”¨ElastAlert2å¯¹ESä¸­çš„æ—¥å¿—åˆ›å»ºå‘Šè­¦">å¦‚ä½•åˆ©ç”¨ElastAlert2å¯¹ESä¸­çš„æ—¥å¿—åˆ›å»ºå‘Šè­¦</a><time datetime="2024-07-16T09:56:39.000Z" title="å‘è¡¨äº 2024-07-16 17:56:39">2024-07-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/09/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Python%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89pod%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81/" title="å¦‚ä½•åˆ©ç”¨Pythonè·å–æ‰€æœ‰podå®¹å™¨çŠ¶æ€">å¦‚ä½•åˆ©ç”¨Pythonè·å–æ‰€æœ‰podå®¹å™¨çŠ¶æ€</a><time datetime="2024-07-09T09:38:00.000Z" title="å‘è¡¨äº 2024-07-09 17:38:00">2024-07-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/10/K8S%E4%B8%ADMySQL%E4%BD%BF%E7%94%A8NFS%E6%8C%82%E8%BD%BD%E7%9A%84%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" title="K8Sä¸­MySQLä½¿ç”¨NFSæŒ‚è½½çš„å¼‚å¸¸é—®é¢˜å¤„ç†">K8Sä¸­MySQLä½¿ç”¨NFSæŒ‚è½½çš„å¼‚å¸¸é—®é¢˜å¤„ç†</a><time datetime="2024-05-10T12:58:02.000Z" title="å‘è¡¨äº 2024-05-10 20:58:02">2024-05-10</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By NoardGuo-Ops</span><span class="framework-info"><span>æ¡†æ¶ </span><a href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>